<!--
title: Migration & Scheduling & Probes
description: 
published: true
date: 2025-11-23T10:12:16.538Z
tags: 
editor: ckeditor
dateCreated: 2025-11-23T09:00:45.253Z
-->

<h1>Migrating Virtual Machines from Foreign Hypervisors</h1>
<ul>
  <li>With the migration toolkit for virtualization (MTV), multiple VMs cloud be migrated from a compatible hypervisor, such as VMware vSphere or Red&nbsp;Hat Virtualization, to OpenShift Virtualization.</li>
  <li>MTV operator provide ForkliftController object that has these APIs:</li>
</ul>
<figure class="image image_resized" style="width:100%;"><img src="/mtv_resources-v2.svg"></figure>
<ol>
  <li><code><strong>Provider:</strong></code>Contains the API endpoint and the credentials to<mark class="marker-yellow"> interact with the source and destination virtualization systems.</mark></li>
  <li><code><strong>NetworkMap:</strong></code>Declares the source network on the remote virtualization system and the destination network for the imported VMs in OpenShift Virtualization.</li>
  <li><code><strong>StorageMap:</strong></code>Declares the source datastores on the remote virtualization system and the destination storage class for the imported VMs in OpenShift Virtualization.</li>
  <li><code><strong>Plan:</strong></code><mark class="marker-yellow">Contains the parameters to migrate the VMs from the source </mark><code>Provider</code> to OpenShift Virtualization.</li>
  <li><code><strong>Migration:</strong></code><mark class="marker-yellow">Executes the VM migration as defined in the plan CRD</mark>. The migration CRD also tracks the status of each migration phase:<ul>
      <li><code>Initialize</code>: Initialize migration.</li>
      <li><code>DiskAllocation</code>: Allocate disks.</li>
      <li><code>ImageConversion</code>: Convert image to <code>kubevirt</code> format.</li>
      <li><code>DiskTransferV2v</code>: Copy disks.</li>
      <li><code>VirtualMachineCreation</code>: Create the VM.</li>
    </ul>
  </li>
</ol>
<h4>VM Providers</h4>
<ul>
  <li>The <code>Provider</code> CR stores attributes that enable MTV to connect to and interact with the source and target VM providers. The MTV can interact with the following hypervisors:<ul>
      <li>VMware vSphere</li>
      <li>Red&nbsp;Hat Virtualization (RHV)</li>
      <li>OpenStack</li>
      <li>Remote OpenShift Virtualization clusters</li>
    </ul>
  </li>
</ul>
<blockquote>
  <p>The MTV automatically creates the <code>host</code> provider for the local OpenShift Virtualization cluster in the <code>openshift-mtv</code> namespace.</p>
</blockquote>
<ul>
  <li><strong>Migration</strong> → <strong>Providers for virtualization</strong> and click <strong>Create Provider</strong>.</li>
</ul>
<h4>Migration Plan</h4>
<ul>
  <li>The <code>Plan</code> CR defines a migration plan with a list of VMs from the same VM provider and associated infrastructure mappings.</li>
  <li>The <code>Migration</code> CR runs a migration plan.</li>
  <li><strong>Migration</strong> → <strong>Plans for virtualization</strong> and click <strong>Create plan</strong></li>
</ul>
<h6><strong>Cold migration</strong></h6>
<ul>
  <li>The source VM is shut down, and then the data is transferred to the target OpenShift cluster. After the transfer is complete, the VM is powered on, in OpenShift Virtualization.</li>
</ul>
<h6><strong>Warm migration</strong></h6>
<ul>
  <li>The <i>precopy stage</i> uses changed block tracking (CBT) snapshots on the source VM provider to<mark class="marker-yellow"> copy the VM data while the VM is running</mark>. You must enable CBT for each source VM and each VM disk to use warm migration.</li>
  <li>The <i>cutover stage</i><mark class="marker-yellow"> shuts down the VM and copies the remaining data to the target cluster</mark>. The VM is then started on OpenShift Virtualization. You can manually start the cutover stage from the web console, or you can schedule a cutover time in the migration plan manifest.</li>
</ul>
<h4>MTV worker pods</h4>
<ul>
  <li>The importer pod transfers the VM image from the source <code>Provider</code> to a data volume in the target OpenShift cluster.</li>
  <li>The conversion pod runs the <code>virt-v2v</code> tool to install and configure the required device drivers on the VM root disk for the VM to run on OpenShift Virtualization, and then transfers the disk to a PVC.</li>
</ul>
<blockquote>
  <p>To clean up the temporary resources that the MTV creates during the migration, such as the migration pods and temporary PVCs, you must archive the migration plan.&nbsp;</p>
</blockquote>
<h4>Importing VMs from VMware</h4>
<ul>
  <li>The MTV operator uses the VDDK SDK to accelerate transferring virtual disks from VMware vSphere. So, creating VDDK container image is essential.</li>
</ul>
<pre><code class="language-plaintext">mkdir -vp /tmp/vddk
cd /tmp/vddk
tar -xzf VMware-vix-disklib-version.x86_64.tar.gz

FROM registry.access.redhat.com/ubi8/ubi-minimal
USER 1001
COPY vmware-vix-disklib-distrib /vmware-vix-disklib-distrib
RUN  mkdir -vp /opt
ENTRYPOINT ["cp", "-vr", "/vmware-vix-disklib-distrib", "/opt"]

TAG=&lt;registry_route_or_server_path&gt;/vddk:latest
podman build . -t ${TAG}
podman push ${TAG}</code></pre>
<h1>Controlling the Scheduling of Virtual Machines</h1>
<h4>Configure the Run Strategy</h4>
<ul>
  <li>A VM's run strategy <mark class="marker-yellow">determines the behavior of a VMI according to a series of conditions</mark>, which are defined in the <code>.spec.running</code> or the <code>.spec.runStrategy</code> parameter.<ul>
      <li><code><strong>.spec.running</strong></code>
        <ul>
          <li>The <code>.spec.running</code> Boolean value specifies whether the VM is running.<ul>
              <li><code><strong>true</strong></code>
                <ul>
                  <li>When the Boolean is set to <code>true</code>, Red&nbsp;Hat OpenShift Virtualization ensures that the VM is always running. OpenShift Virtualization restarts the VM if it fails. OpenShift Virtualization also restarts the VM when you stop it by gracefully shutting down the operating system or when you delete the VMI resource.</li>
                </ul>
              </li>
              <li><code><strong>false</strong></code>
                <ul>
                  <li>When you set the <code>.spec.running</code> Boolean to <code>false</code>, OpenShift Virtualization ensures that the VM is not running.</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>OpenShift Virtualization automatically updates the Boolean when you control the VM by using the <code>virtctl</code> command or by using the web console. If you run the <code>virtctl stop</code> command or click <strong>Actions</strong> → <strong>Stop</strong> in the OpenShift web console, then OpenShift Virtualization switches the <code>.spec.running</code> Boolean to <code>false</code>. If you run the <code>virtctl start</code> command or click <strong>Actions</strong> → <strong>Start</strong> in the OpenShift web console, then OpenShift Virtualization switches the <code>.spec.running</code> Boolean to <code>true</code>.<ul>
      <li><code><strong>.spec.runStrategy</strong></code>
        <ul>
          <li>The <code>.spec.runStrategy</code> parameter provides more control over the VM status than the <code>.spec.running</code> Boolean. For example, when the <code>.spec.running</code> Boolean is <code>true</code>, you cannot stop a VM by gracefully shutting down its operating system, because OpenShift Virtualization detects that the VM is not running and then restarts it.</li>
          <li>The <code>.spec.runStrategy</code> parameter accepts any of the following values:<ul>
              <li><code><strong>RerunOnFailure</strong></code>
                <ul>
                  <li>Restarts the VM when it fails. If you gracefully shut down the operating system from inside the VM, then OpenShift Virtualization does not restart the VM.</li>
                </ul>
              </li>
              <li><code><strong>Always</strong></code>
                <ul>
                  <li>Ensures that the VM is always running. Using this value has the same effect as setting the <code>.spec.running</code> Boolean to <code>true</code>.</li>
                </ul>
              </li>
              <li><code><strong>Halted</strong></code>
                <ul>
                  <li>Ensures that the VM is not running. Using this value has the same effect as setting the <code>.spec.running</code> Boolean to <code>false</code>.</li>
                </ul>
              </li>
              <li><code><strong>Manual</strong></code>
                <ul>
                  <li>Performs no automatic action. If the VM fails, then OpenShift Virtualization does not restart it. You must manage the VM by using the <code>virtctl start</code> or <code>virtctl stop</code> command, or by using the OpenShift web console.</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>The <code>.spec.running</code> and <code>.spec.runStrategy</code> parameters are mutually exclusive. If you specify both parameters, then OpenShift Virtualization returns an error.</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
