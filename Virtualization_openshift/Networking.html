<!--
title: Networking
description: 
published: true
date: 2025-11-18T18:48:00.701Z
tags: network
editor: ckeditor
dateCreated: 2025-11-18T16:45:53.502Z
-->

<blockquote>
  <p><i>Software-Defined Network (SDN): E</i>nables Kubernetes to control the network traffic and the network resources programmatically, similar to the VMware vSwitch software program.</p>
</blockquote>
<h1>Cluster Network Operator</h1>
<ul>
  <li>Manages the SDN by calling a <mark class="marker-yellow">plug-in</mark> that adheres to the <mark class="marker-yellow">Container Network Interface</mark> (CNI) specification to configure container network interfaces like:<ul>
      <li>OVN-Kubernetes</li>
      <li>Kuryr</li>
    </ul>
  </li>
</ul>
<blockquote>
  <p>OVN-Kubernetes provider, which runs the Open <mark class="marker-yellow">vSwitch (OVS) plug-in on each node</mark>, is selected by default during installation.</p>
</blockquote>
<blockquote>
  <p><strong>the vswitch plugin does not replace kube‑proxy.</strong> In OpenShift, kube‑proxy is still responsible for implementing Kubernetes Service semantics (cluster IPs, NodePorts, load‑balancing). The vswitch (part of the OpenShift SDN or OVN‑Kubernetes plugin) handles <i>pod‑to‑pod networking and policy enforcement</i></p>
</blockquote>
<figure class="image image_resized" style="width:100%;"><img src="/pod-sdn.svg"></figure>
<figure class="image image_resized" style="width:100%;"><img src="/pod-service-sdn.svg"></figure>
<p>&nbsp;</p>
<pre><code class="language-plaintext">oc get network/cluster -o yaml
apiVersion: config.openshift.io/v1
kind: Network
metadata:
...output omitted...
spec:
  clusterNetwork:
  - cidr: 10.8.0.0/14 1
    hostPrefix: 23
  externalIP:
     policy: {}
  networkType: OVNKubernetes
  serviceNetwork:
  - 172.30.0.0/16 2
...output omitted...</code></pre>
<p>&nbsp;</p>
<figure class="table">
  <table style="background-color:rgb(255, 255, 255);">
    <tbody>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/1.svg" alt="1"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The pod network CIDR</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/2.svg" alt="2"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The service network CIDR</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<h4>DNS Operator&nbsp;</h4>
<ul>
  <li>Deploys and runs a DNS server, which monitors the services to automatically create and update the DNS records.&nbsp;</li>
  <li>Manages the <code>svc.cluster.local</code> domain name for services, and creates records in the <code>servicename.namespace.svc.cluster.local</code> format.</li>
  <li>The operator automatically creates the <code>/etc/resolv.conf</code> configuration file inside the pods so that name resolution is immediately available without further configuration.</li>
</ul>
<h4>Exposing a vm</h4>
<ul>
  <li>The <code>virt-launcher</code> process that runs inside the pod runs a Dynamic Host Configuration Protocol (DHCP) server, which provides an<mark class="marker-yellow"> IP address and the DNS configuration to the VM.</mark></li>
  <li>The <code>virt-launcher</code> pod redirects the inbound traffic to the VM and routes the outbound traffic to its destination.</li>
  <li>After editing a <code>VirtualMachine</code> resource manifest, Kubernetes does not automatically propagate the changes to the <code>VirtualMachineInstance</code> and <code>virt-launcher</code> pod resources.&nbsp;<mark class="marker-yellow"> Restart the VM to re-create the resources and apply the latest changes.</mark></li>
</ul>
<blockquote>
  <p>When you restart a VM resource in OpenShift:</p>
  <ol>
    <li>The VM controller <strong>terminates the current VMI</strong> (the running instance).</li>
    <li>A <strong>new VMI object and virt-lanucher pod are created</strong> to represent the restarted VM.</li>
    <li>The new VMI goes through the full boot process again (cloud‑init, disk attach, network setup).</li>
  </ol>
  <p>So yes — restarting a VM destroys the existing VMI and creates a new one. This is by design: VMIs are ephemeral objects tied to the current execution of the VM.</p>
</blockquote>
<ul>
  <li>To label a vm without restarting it label its virt-lanucher pod ( temporary solution, when restarting the vm the label will be gone )</li>
  <li><code>virtctl</code> tool &nbsp;provides a way to create a service from the command line.</li>
</ul>
<pre><code class="language-plaintext"> virtctl expose vmi backendvm --name backend \
  --type ClusterIP --port 80 --target-port 8080</code></pre>
<h4>Headless Service for a Virtual Machine</h4>
<ul>
  <li>A headless service creates a DNS entry that ties a DNS name to the IP address of a pod.</li>
</ul>
<h4>Set a Cluster-scoped Network Policy</h4>
<ul>
  <li><code>AdminNetworkPolicy</code> (ANP) resource: &nbsp;a cluster-scoped network policy that can restrict or enable access<mark class="marker-yellow"> before creating the targeted namespace</mark></li>
  <li>The ANP resource is similar to a namespace-scoped network policy, with three additional attributes: the <code>subject</code>, the <code>priority</code>, and the <code>action</code> attributes.<ul>
      <li><code>subject</code> attribute identifies the namespaces or pods that the ANP applies to\</li>
      <li><code>priority</code> attribute determines the order of evaluation. The lower the value, the higher the precedence. The priority attribute takes a value from 0-99. If two ANP policies have conflicting rules, then <mark class="marker-yellow">the policy with the lower-priority attribute value takes precedence over the other rule.</mark></li>
      <li><code>action</code> attribute takes a value of <code>Allow</code>, <code>Deny</code>, or <code>Pass</code>.</li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<figure class="table">
  <table style="background-color:rgb(255, 255, 255);">
    <thead>
      <tr>
        <th style="padding:5px;vertical-align:top;"><strong>Action</strong></th>
        <th style="padding:5px;vertical-align:top;"><strong>Meaning</strong></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="padding:5px;vertical-align:top;">Allow</td>
        <td style="padding:5px;vertical-align:top;">Allow ingress or egress</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;">Deny</td>
        <td style="padding:5px;vertical-align:top;">Deny ingress or egress</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;">Pass</td>
        <td style="padding:5px;vertical-align:top;">Defer access control to the namespaced network policies</td>
      </tr>
    </tbody>
  </table>
</figure>
<ul>
  <li>Namespaced network policies cannot override an ANP that uses <code>Allow</code> or <code>Deny</code> actions.&nbsp;<br>&nbsp;</li>
</ul>
<pre><code class="language-plaintext">apiVersion: policy.networking.k8s.io/v1alpha1
kind: AdminNetworkPolicy
metadata:
  name: sample-anp-allow-monitoring 1
spec:
  priority: 50 2
  subject:
    namespaces:
      matchLabels:
        security: unrestricted 3
  ingress: 4
  - name: "allow-monitoring-unrestricted" 5
    action: "Allow" 6
    from:
    - namespaces:
        matchLabels:
          kubernetes.io/metadata.name: monitoring</code></pre>
<figure class="table">
  <table style="background-color:rgb(255, 255, 255);">
    <tbody>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/1.svg" alt="1"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">Specify a name for the ANP.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/2.svg" alt="2"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The <code>priority</code> field determines the precedence of the traffic rules.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/3.svg" alt="3"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">Use labels to select the namespaces to which the rules apply.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/4.svg" alt="4"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">ANPs have both ingress and egress rules.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/5.svg" alt="5"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">Specify a name for the ANP rule.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/6.svg" alt="6"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The <code>action</code> value can be <code>Allow</code>, <code>Deny</code>, or <code>Pass</code>.</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<blockquote>
  <p>Non-cloud environments can also configure an <code>External IP</code> to send traffic to services by using the <code>LoadBalancer</code> service type. The <code>External IP</code> feature is disabled by default and can be a security risk, because sensitive in-cluster traffic that is destined for external resources might be intercepted.</p>
</blockquote>
<h4>Ingress Operator</h4>
<ul>
  <li>Manages the Ingress Controller, and provides the typical way to enable external access to cluster resources. The Ingress Controller is limited to HTTP, HTTPS, and TLS by using SNI, and is configured to accept external requests and to proxy them based on configured routes.</li>
</ul>
<h4>Red&nbsp;Hat OpenShift routes</h4>
<ul>
  <li>A route connects a public-facing DNS hostname to an internal-facing service IP.</li>
</ul>
<figure class="image image_resized" style="width:100%;"><img src="/route.svg"></figure>
<ul>
  <li>Red&nbsp;Hat OpenShift assigns a name in the <code><i>routename-namespace.default_domain</i></code> format.</li>
  <li>For other traffic types, such as UDP traffic or non-web TCP traffic, Red&nbsp;Hat recommends that you use services of the <code>LoadBalancer</code> or the <code>NodePort</code> type.</li>
  <li>Routes could be hostname or path based</li>
</ul>
<pre><code class="language-plaintext"> oc expose service/web --name web \
  --hostname web-production.apps.mycompany.com
 oc expose service/restapi --path=/api \
  --hostname=intranet-prod.apps.mycompany.com</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
