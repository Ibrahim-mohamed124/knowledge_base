<!--
title: Chapter_one ~ Air
description: 
published: true
date: 2025-11-17T12:14:11.340Z
tags: 
editor: ckeditor
dateCreated: 2025-11-17T09:09:08.764Z
-->

<h3>Introduction to OpenShift Virtualization</h3>
<ul>
  <li><i><mark class="marker-yellow">Kernel-based Virtual Machine</mark></i><mark class="marker-yellow"> (KVM) </mark>technology as the hypervisor and the<mark class="marker-yellow"> libvirt libraries</mark> for <mark class="marker-yellow">defining the virtual machines.</mark></li>
  <li>KVM and libvirt are run in <mark class="marker-yellow">a container that can be deployed in Kubernetes and OpenShift platforms</mark> along with containerized applications.</li>
  <li>The <i><mark class="marker-yellow">Quick EMUlator</mark></i><mark class="marker-yellow"> (QEMU) guest agent passes information about a VM to the host.</mark></li>
  <li>OpenShift Virtualization operator offers features for enterprise-grade virtualization, such as live migration, high availability, system scheduling, power management, image management, snapshots, thin provisioning, and monitoring.<ul>
      <li>Based on the <i>KubeVirt</i> Kubernetes virtualization add-on</li>
    </ul>
  </li>
</ul>
<figure class="image image_resized" style="width:100%;"><img src="/containerizingkvm.svg"></figure>
<p>&nbsp;</p>
<h3>KubeVirt</h3>
<ul>
  <li>KubeVirt delivers container-native virtualization by using the <i>Kernel-based Virtual Machine (KVM)</i> Linux Kernel hypervisor within a Kubernetes container.</li>
</ul>
<h3>OpenShift Virtualization Components&nbsp;</h3>
<ul>
  <li>OpenShift Virtualization is an open source technology to enable running VMs in Red&nbsp;Hat OpenShift with the OpenShift Virtualization operator. It is based on the upstream <i>KubeVirt</i> project, and runs and manages traditional VMs as if they were containers.</li>
  <li><strong>HyperConverged Operator (HCO)</strong>
    <ul>
      <li>The HCO <mark class="marker-yellow">deploys and manages virtualization components and supplemental operators,</mark> such as the <i>Containerized Data Importer (CDI)</i>, for OpenShift Virtualization.</li>
    </ul>
  </li>
  <li><strong>Hostpath Provisioner Operator (HPP)</strong>
    <ul>
      <li>The HPP operator is a<mark class="marker-yellow"> local storage provisioner for virtual machines</mark>. Local storage or mounted volumes on nodes can be provisioned to <i>Virtual Machine Instances (VMIs)</i>.</li>
    </ul>
  </li>
  <li><strong>QEMU agent</strong>
    <ul>
      <li>The <i>Quick EMUlator</i> (QEMU) <mark class="marker-yellow">guest agent is a daemon that runs inside the VM and passes information to the host about the VM, users, file systems, and secondary networks.</mark></li>
    </ul>
  </li>
  <li><strong>Kernel-based Virtual Machine (KVM)</strong>
    <ul>
      <li>KVM is an open source virtualization technology that is built into the Linux kernel that enables a host machine to run multiple, isolated virtual environments, <i>guest VMs</i>.</li>
    </ul>
  </li>
  <li><strong>Containerized Data Importer (CDI)</strong>
    <ul>
      <li>An upstream<mark class="marker-yellow"> Kubernetes component that delivers a hardware-independent management layer for storage volumes that attach to deployed instances.</mark></li>
    </ul>
  </li>
  <li><strong>Virtual machine consoles</strong>
    <ul>
      <li>Connect to VMs by using command-line tools, the web console, and common protocols, such as <i>Remote Desktop Protocol</i> (RDP) for Windows VMs, and SSH.</li>
    </ul>
  </li>
  <li><strong>Stand-alone Virtual Machine Instances (VMIs)</strong>
    <ul>
      <li>Use the command line and the web console to<mark class="marker-yellow"> manage stand-alone VMIs that were created independently from the OpenShift cluster,</mark> such as VMIs that were created by using scripts, with automation, or with other command-line methods.</li>
    </ul>
  </li>
</ul>
<figure class="image image_resized" style="width:100%;"><img src="/virtualization_components.svg"></figure>
<h4>The OpenShift Virtualization Operator</h4>
<ul>
  <li><code><strong>virt-api</strong></code>
    <ul>
      <li><mark class="marker-yellow">A cluster-level component that provides an HTTP RESTful entry point to manage VM and VM-related workflows within the cluster</mark>. It updates virtualization Custom Resource Definitions (CRD) and handles defaulting and validating Virtual Machine Instance (VMI) CRDs.</li>
    </ul>
  </li>
  <li><code><strong>virt-controller</strong></code>
    <ul>
      <li><mark class="marker-yellow">A cluster-level component that handles cluster-wide virtualization functions and manages the lifecycle of pods that are associated with VMIs.</mark> The operator creates the pod where the VM objects execute.</li>
    </ul>
  </li>
  <li><code><strong>virt-handler</strong></code>
    <ul>
      <li><mark class="marker-yellow">A host-level DaemonSet resource, which runs on each node, and monitors for changes to a VM object and runs the necessary operations to meet the required state.</mark></li>
    </ul>
  </li>
  <li><code><strong>virt-launcher</strong></code>
    <ul>
      <li><mark class="marker-yellow">The primary container in a VMI-associated pod runs the </mark><code><mark class="marker-yellow">virt-launcher</mark></code><mark class="marker-yellow"> component to provide control groups (cgroups) and namespaces for hosting the VMI process</mark>. This processing occurs when the <code>virt-handler</code> component passes the VM CRD object to the <code>virt-launcher</code> component. The <code>virt-launcher</code> component uses a container-local <code>libvirtd</code> instance to start the VMI. The <code>virt-launcher</code> component then monitors the VMI process until the process exits at VMI termination.</li>
    </ul>
  </li>
  <li><code><strong>libvirtd</strong></code>
    <ul>
      <li><mark class="marker-yellow">Every VMI pod has a </mark><code><mark class="marker-yellow">libvirtd</mark></code><mark class="marker-yellow"> instance for the </mark><code><mark class="marker-yellow">virt-launcher</mark></code><mark class="marker-yellow"> component to manage the lifecycle of a VMI process.</mark></li>
    </ul>
  </li>
</ul>
<h4>The HyperConverged Operator</h4>
<p>&nbsp;</p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td style="padding:5px;vertical-align:top;">Resource name</td>
        <td style="padding:5px;vertical-align:top;">Description</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>deployment/hco-webhook</code></td>
        <td style="padding:5px;vertical-align:top;">Validates the HyperConverged custom resource contents.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>deployment/hyperconverged-cluster-cli-download</code></td>
        <td style="padding:5px;vertical-align:top;">Provides the <code>virtctl</code> tool binaries to the cluster so that you can download them directly from the cluster.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>kubevirt/kubevirt-kubevirt-hyperconverged</code></td>
        <td style="padding:5px;vertical-align:top;">Contains all needed operators, CRs, and objects for OpenShift Virtualization.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>ssp/ssp-kubevirt-hyperconverged</code></td>
        <td style="padding:5px;vertical-align:top;">A Scheduling, Scale, and Performance (SSP) CR.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>cdi/cdi-kubevirt-hyperconverged</code></td>
        <td style="padding:5px;vertical-align:top;">A Containerized Data Importer (CDI) CR.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>networkaddonsconfig/cluster</code></td>
        <td style="padding:5px;vertical-align:top;">A CR that instructs and is managed by the Cluster Network Addons operator.</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<h4>Operator CRs</h4>
<ul>
  <li>The chosen options during the HCO installation determine the operators that are deployed.</li>
</ul>
<figure class="image image_resized" style="width:100%;"><img src="/virt_operators.svg"></figure>
<p>&nbsp;</p>
<ul>
  <li>The default settings include the following operator CRs:<ul>
      <li><strong>Containerized Data Importer (CDI)</strong>
        <ul>
          <li>The <mark class="marker-yellow">CDI operator components manage the authorization to upload VM disks into PVCs.</mark> The CDI also<mark class="marker-yellow"> directs external disk upload traffic to the appropriate upload server pod so that it can be written to the correct PVC and provides a helper pod that imports a virtual machine image into a PVC when creating a data volume.</mark></li>
        </ul>
      </li>
      <li><strong>Hostpath Provisioner (HPP)</strong>
        <ul>
          <li>In an environment without available network storage, you can deploy the<mark class="marker-yellow"> hostpath provisioner to provision VMs on a node's local storage</mark>. The HPP operator includes<mark class="marker-yellow"> a deployment resource to provide a worker pod for each node where the HPP is designated to run</mark>. The pods mount the backing storage on the node. The<mark class="marker-yellow"> operator also deploys two daemonsets with driver interfaces of the HPP.</mark></li>
        </ul>
      </li>
      <li><strong>Cluster Network Addons</strong>
        <ul>
          <li>The Cluster Network Addons operator deploys networking components on a cluster and manages the related resources for extended network functions.</li>
        </ul>
      </li>
      <li><strong>Scheduling, Scale, and Performance (SSP)</strong>
        <ul>
          <li>The SSP operator deploys<mark class="marker-yellow"> common templates, related default boot sources, pipeline tasks, and the template validator.</mark></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<h3>Requirements</h3>
<ol>
  <li>&nbsp;All CPUs must be supported by Red&nbsp;Hat Enterprise Linux&nbsp;9</li>
  <li>Intel VT or AMD-V hardware virtualization enabled, and have the no-execute (NX) flag enabled.</li>
  <li>For live migration, shared storage is required.</li>
  <li>&nbsp;create a <mark class="marker-yellow">default OpenShift Virtualization or OpenShift Container Platform storage class</mark> by setting the <code>storageclass.kubevirt.io/is-default-virt-class=true</code> or <code>storageclass.kubernetes.io/is-default-class=true</code> annotation on the storage class.</li>
</ol>
<h4>HyperConverged Configuration</h4>
<ul>
  <li><strong>Deployment Strategy:</strong>
    <ol>
      <li><strong>&nbsp;</strong>specify nodes by using node selectors, affinity rules, and tolerations for different virtualization workloads.&nbsp;</li>
      <li>specify node placement rules for both virtual machines and operators.&nbsp;</li>
    </ol>
  </li>
  <li><strong>Live Migration Configuration:</strong>
    <ol>
      <li>Live migration limits and timeouts are applied so that migration processes do not overwhelm the cluster.</li>
    </ol>
  </li>
  <li><strong>Eviction Strategy:</strong>
    <ol>
      <li>defines at the cluster level whether to migrate the VMI instead of shutting it off when nodes are placed in maintenance mode and drained of all workloads.</li>
      <li>If the VMI-specific eviction strategy field is set, then it overrides the cluster-level field.</li>
    </ol>
  </li>
  <li><strong>Feature Gates:</strong>
    <ol>
      <li>key=value pair settings to enable or disable features.</li>
      <li>Feature gates for OpenShift Virtualization&nbsp;4.16 are enabled to import common boot images and to run as non-root.</li>
    </ol>
  </li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
