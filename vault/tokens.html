<!--
title: tokens
description: 
published: true
date: 2025-10-20T18:21:29.624Z
tags: vault, tokens
editor: ckeditor
dateCreated: 2025-10-14T17:07:40.219Z
-->

<h1>Token auth method</h1>
<ul>
  <li>Responsible for generating and storing tokens</li>
  <li>default lease ttl = 32 days</li>
  <li>Types of tokens:<ul>
      <li>service tokens:<ul>
          <li>default token type</li>
          <li>persisted to storage ( for heavy i/o) | saved in the backend storage</li>
          <li>can create child tokens</li>
          <li>are not replicated to DR</li>
        </ul>
      </li>
      <li>patch tokens:<ul>
          <li>encrypted blobs ( large binary objects )</li>
          <li>good for high-volume operations like encryption</li>
          <li>are no persisted to storage</li>
          <li>used for DR replication cluster promotion</li>
          <li>cannot be renewed, revoked</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<figure class="image"><img src="/capsfdture.png"></figure>
<pre><code class="language-plaintext">$ vault token lookup &lt;token&gt;</code></pre>
<p>&nbsp;</p>
<h2>Token Heirarchy</h2>
<ul>
  <li>Every token has TTL expect initial root token</li>
  <li>root tokens can create other root tokens <mark class="marker-yellow">$ vault token create</mark></li>
  <li>TTL can be renewed till it hits the max_TTL<mark class="pen-red">, </mark><mark class="marker-pink">renewal must be done before TTl</mark></li>
  <li>When Parents tokens are revoked all their children are revoked as well</li>
</ul>
<h2>Token lifecycle</h2>
<ul>
  <li>Periodic Tokens:<ul>
      <li>required sudo privileges or root token permissions on the path auth/token/create</li>
      <li>Do not have max_TTL, can be renewed indefinitely</li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">$ vault token create  -policy=   -period=24h </code></pre>
<ul>
  <li>Service tokens with use limits:<ul>
      <li>will expire at their end of last use, regardless the TTL and Max_TTL and vice versa</li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">$ vault token create -policy= -use-limit=x</code></pre>
<p>&nbsp;</p>
<ul>
  <li>Orphan tokens:<ul>
      <li>required sudo privileges or root token permissions on the path auth/token/create</li>
      <li>Do not have parents!</li>
      <li>expire only at their TTL</li>
      <li>Can create child tokens that will be orphan when their parents are deleted</li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">$ vault token create -policy -orphan</code></pre>
<p>&nbsp;</p>
<p>∅ The auth methods can be configured to generate certain types of tokens with certain parameters:</p>
<pre><code class="language-plaintext">$ vault write auth/..../user   token_type=  token_ttl=  period=</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">$ vault token create|revoke|renew|lookup|capablities on a path /</code></pre>
<p>&nbsp;</p>
<h2>Root tokens</h2>
<ul>
  <li>Root tokens can be created by using unseal/recovery keys provided that their is a quorum</li>
</ul>
<pre><code class="language-plaintext">$ vault operator generate-root  -init</code></pre>
<p>&nbsp;</p>
<ul>
  <li>This command provide one OTP that will be used to decrypt the root key after its generation</li>
  <li>a quorum of &nbsp;the key holders must run <mark class="marker-yellow">$ vault operator generate-root</mark> with their unseal keys</li>
  <li>Finally decrypt the key</li>
</ul>
<pre><code class="language-plaintext">$ vault operator generate-root -opt=one time passowrd -decode=the encyrpted key</code></pre>
<p>&nbsp;</p>
<h2>Token accessors</h2>
<ul>
  <li>are IDs for tokens, and can be used to do some operations on tokens without exposing the actual token</li>
</ul>
<pre><code class="language-plaintext">$ vault token lookup -accessor </code></pre>
<p>&nbsp;</p>
<p>∅ DR replication clusters need orphan tokens&nbsp;</p>
<p>∅ CIDR bound tokens &gt; accessed only from certain netwrok</p>
<p>&nbsp;</p>
<pre><code class="language-plaintext">$ vault list auth/token/accessors</code></pre>
<p>&nbsp;</p>
