<!--
title: Introduction to OCP instillation
description: 
published: true
date: 2025-12-06T08:40:51.438Z
tags: ocp instillation openshift openshift-installer
editor: ckeditor
dateCreated: 2025-11-17T20:17:18.603Z
-->

<h3>installation methods</h3>
<ol>
  <li>Interactive by using the assisted installer ( require internet connectivity ). It depends manly on REST APIs to install the cluster</li>
  <li>Local Agent based for disconnected environments. Is is similar to the assisted by the agent must be configured to act as the api.openshift.com API ( this api is responsible for providing coreos images and others in the assisted installation)</li>
  <li>Automated by using the baseboard management controller (BMC) like ILO in the HPE servers</li>
  <li>Full control.&nbsp;</li>
</ol>
<h3><strong>Ignition files</strong></h3>
<ul>
  <li>Starting files that are generated by openshift-installer binary. These files are used to configure bootstrap, control planes, compute nodes.</li>
  <li>Ignition process: consume the ignition files that are generated by either openshift-installer or machine config operator(changes) to configure the ocp machines in the early stage of the installation at the boot of each machine.</li>
</ul>
<blockquote>
  <p>Most changes to systemd, CRI-O and kubelet, the kernel, Network Manager and other system features, on OpenShift Container Platform nodes, can be done by creating what are referred to as <code>MachineConfig</code> objects that are managed by the Machine Config Operator.</p>
</blockquote>
<pre><code class="language-plaintext">{
  "ignition": {
    "version": "3.1.0" 1
  },
  "passwd": { 2
    "users": [
      {
        "name": "core",
        "sshAuthorizedKeys": [
          "ssh-rsa AAA...hlw== lab@utility.lab.example.com\n",
          "ssh-rsa AAA...3DR\n"
        ]
      }
    ]
  },
  "storage": { 3
    "files": [
      {
...output omitted...
      {
        "overwrite": false,
        "path": "/etc/motd",  4
        "user": {
          "name": "root"
        },
        "append": [
          {
            "source": "data:text/plain;charset=utf-8;base64,VGh...lCg=="
          }
        ],
        "mode": 420
      },
...output omitted...
  "systemd": { 5
    "units": [
      {
        "contents": "[Unit]\nDescription=Bootstrap a Kubernetes cluster\nRequires=crio-configure.service\nWants=kubelet.service\nAfter=kubelet.service crio-configure.service\nConditionPathExists=!/opt/openshift/.bootkube.done\n\n[Service]\nWorkingDirectory=/opt/openshift\nExecStart=/usr/local/bin/bootkube.sh\n\nRestart=on-failure\nRestartSec=5s\n",
        "name": "bootkube.service"
      },
...output omitted...
      }
    ]
  }
}

1- Ignition version

2- Configures SSH public keys for the user core.

3- Storage section

4- Appends to the /etc/motd file the base64 encoded source data.

5- Creates a systemd service unit called bootkube.service that executes the script /usr/local/bin/bootkube.sh.

</code></pre>
<h4><strong>Features:</strong></h4>
<ul>
  <li>Unifies cloud-init, kickstart in the booting process</li>
  <li>Executed at the initramfs stage</li>
  <li>Data is encoded in base64 &nbsp;&gt; &nbsp;&nbsp;<code><strong>echo "VGh...lCg==" | base64 -d</strong></code></li>
</ul>
<h4><strong>Location of the Ignition files:</strong></h4>
<ul>
  <li>Local disk</li>
  <li>Cloud metadata</li>
  <li>HTTP, HTTPS servers</li>
</ul>
<blockquote>
  <p>To customize the ignition files edit the<mark class="marker-yellow"> install-config.yaml,</mark> execute the openshift-installer binary, which creates Kubernetes manifests files from the install-config.yaml, then execute the openshfit-installer again to generate the ignition files from Kubernetes manifests files.</p>
</blockquote>
<h4>Troubleshooting</h4>
<ul>
  <li>After the RHCOS system boots, you can check the ignition configuration used to configure the system. &nbsp;&gt; <code><strong>cat /boot/ignition/config.ign</strong></code></li>
  <li>check the ignition logs. &nbsp;&gt; <code><strong>journalctl -t ignition</strong></code></li>
</ul>
<h3><strong>Instillation process</strong></h3>
<ol>
  <li>Run openshift-installer, which <mark class="marker-yellow">interactively ask for info about the infra on which the ocp will be installed,</mark> and creates the<mark class="marker-yellow"> install-config.yaml</mark></li>
  <li>The openshift-installer creates the <mark class="marker-yellow">k8s manifests from install-config.yaml</mark>, which<mark class="marker-yellow"> contain instruction how to build the resources that will install openshift.</mark></li>
  <li>The openshift-installer creates th<mark class="marker-yellow">e ignition files from the k8s manifests files</mark>, bootstrap.ign, controlplane.ign, and the worker.ign.</li>
</ol>
<figure class="image image_resized" style="width:100%;"><img src="/openshift-installation-process-pdf-iii1.svg"></figure>
<p>&nbsp; 4. The bootstrap machine starts up and fetches the <mark class="marker-yellow">all ignition files from the initial data source and stores them in the machine configuration server MCS</mark> to provide these files the control plane and workers nodes in the future , after finishing the boot process k8s api and the etcd are running on the bootstrap node.</p>
<figure class="image image_resized" style="width:100%;"><img src="/openshift-installation-process-iv2.svg"></figure>
<p>&nbsp;5. The control plane boots up and fetches the master.ign from the bootstrap<mark class="marker-yellow">, after being redirected from the initial data source</mark></p>
<p>&nbsp;6. The <mark class="marker-yellow">bootstrap starts a control plane node to install ETCD operator, which scales the etcd deployment to 3 using two control planes</mark></p>
<figure class="image image_resized" style="width:100%;"><img src="/openshift-installation-process-pdf-vi3.svg"></figure>
<p>&nbsp; 7. The bootstrap <mark class="marker-yellow">reschedules the control plane components to a master node and move the etcd instance on bootstrap to the master node without etcd. </mark>The <mark class="marker-yellow">MCS is moved to the master nodes as wel</mark>l, then bootstrap shuts down.</p>
<figure class="image image_resized" style="width:100%;"><img src="/openshift-installation-process-pdf-viii4.svg"></figure>
<p>&nbsp; 8. The worker nodes start and fetch the worker.ign from the MCS in the master nodes after being redirected from the initial data source</p>
<figure class="image image_resized" style="width:100%;"><img src="/openshift-installation-process-pdf-x5.svg"></figure>
<figure class="image image_resized" style="width:100%;"><img src="/openshift-installation-process-xi.ii6.svg"></figure>
<p>&nbsp;</p>
<h2>I<strong>nstillation methods</strong></h2>
<p>Full-stack Automation&nbsp;(IPI)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Pre-existing Infrastructure(UPI)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Cloud integration (UPI CI) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Bare metal (UPI BM).</p>
<figure class="image image_resized" style="width:100%;"><img src="/pre-existing-infrastructure.svg"></figure>
<figure class="image image_resized" style="width:100%;"><img src="/full-stack-automation.svg"></figure>
<blockquote>
  <p>Depending on weather the provider has the<mark class="marker-yellow"> openshift machine apis</mark> or not it will be UPI CI or UPI BM (cloud integration CI)</p>
</blockquote>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td style="border-bottom:2px solid rgb(221, 221, 221);border-top:0px;padding:8px;vertical-align:top;">Action</td>
        <td style="border-bottom:2px solid rgb(221, 221, 221);border-top:0px;padding:8px;vertical-align:top;">Full-stack Automation</td>
        <td style="border-bottom:2px solid rgb(221, 221, 221);border-top:0px;padding:8px;vertical-align:top;">Pre-existing Infrastructure</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Build network</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Setup load balancer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Configure DNS</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Hardware or VM provisioning</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">OS installation</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Generate ignition configs</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Control plane node OS support</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer: RHCOS</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User: RHCOS</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Compute node OS support</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer: RHCOS&nbsp;</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User: RHCOS + RHEL&nbsp;7&nbsp;</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Configure persistent storage for the internal registry</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Configure dynamic storage provider</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer&nbsp;</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">User</td>
      </tr>
      <tr>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Configure node provisioning and cluster autoscaling</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Installer</td>
        <td style="border-top:1px solid rgb(221, 221, 221);padding:8px;vertical-align:top;">Only for providers with OpenShift Machine API support&nbsp;</td>
      </tr>
    </tbody>
  </table>
</figure>
<ul>
  <li>Prerequisites:<ul>
      <li><strong>General for both UPI, IPI:</strong>
        <ul>
          <li>Bastion host</li>
          <li>SSH key on the Bastion host to be used for the core user in the worker nodes</li>
          <li>Download openshift-installer, oc</li>
          <li>Get pull-secret to allow pulling ocp images from the redhat registry</li>
          <li>NTP server</li>
          <li>Firewall configurations</li>
        </ul>
      </li>
      <li><strong>UPI:</strong>
        <ul>
          <li>Install RHCOS hosts, and configure network</li>
        </ul>
      </li>
      <li><strong>IPI:</strong>
        <ul>
          <li>Account permissions on the provider</li>
          <li><mark class="marker-yellow">TLS certificates</mark></li>
        </ul>
      </li>
      <li><strong>DNS requirements: for UPI</strong>
        <ul>
          <li>Kubernetes API:<ul>
              <li><mark class="marker-yellow">External</mark>: &nbsp;api.&lt;cluster_name&gt;.&lt;base_domain&gt;.<ul>
                  <li>API loadbalancer for the control planes. Must be A or CNAME record and a PTR record</li>
                </ul>
              </li>
              <li><mark class="marker-yellow">Internal</mark>: &nbsp;&nbsp;Resolvable from cluster nodes only |&nbsp; api-int.&lt;cluster_name&gt;.&lt;base_domain&gt;.<ul>
                  <li>API loadbalancer for the control planes. Must be A or CNAME record and a PTR record</li>
                </ul>
              </li>
            </ul>
          </li>
          <li><mark class="marker-yellow">Routes</mark>: Wildcard DNS record for the router pod that runs on the infranodes | *.apps.&lt;cluster_name&gt;.&lt;base_domain&gt;.</li>
          <li><mark class="marker-yellow">Cluster nodes:</mark>&nbsp; &lt;name&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;.<ul>
              <li>An A and PTR record for each node in the cluster</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<blockquote>
  <p>A complete DNS record takes the form <code>&lt;component&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</code>:</p>
  <p><code>&lt;cluster_name&gt;</code> is the name of the cluster (for instance <code>ocp4</code>).</p>
  <p><code>&lt;base_domain&gt;</code> is the cluster base domain configured in the <code>install-config.yaml</code> configuration file (for instance <code>example.com</code>).</p>
  <p>&nbsp; &nbsp;The reverse DNS records (PTR) are also required.</p>
</blockquote>
<blockquote>
  <p>By default, when installing OpenShift using the<mark class="marker-yellow"> full-stack automation method</mark> on supported cloud providers, <mark class="marker-yellow">the OpenShift installer automatically performs the DNS service configuration.</mark></p>
</blockquote>
<ul>
  <li><mark class="marker-yellow">Administrators must configure the DNS service when installing OpenShift using the full-stack automation method on the following infrastructures:</mark>
    <ul>
      <li>Red&nbsp;Hat OpenStack Platform cloud provider using an external DNS</li>
      <li>VMware vSphere</li>
      <li>Bare metal</li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<ul>
  <li><strong>Firewall: for UPI</strong>
    <ul>
      <li>network connectivity between the cluster nodes. Also, each cluster&nbsp; &nbsp;node must be able to resolve the host names of all other nodes in the cluster.</li>
    </ul>
  </li>
</ul>
<figure class="table" style="width:877.5pt;">
  <table>
    <thead>
      <tr>
        <th style="border-bottom:1.5pt solid #DDDDDD;border-left:1.0pt inset;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:bottom;">Protocol</th>
        <th style="border-bottom:1.5pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:bottom;width:87.8pt;">Port</th>
        <th style="border-bottom:1.5pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:bottom;width:721.0pt;">Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">ICMP</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">N/A</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">Network reachability tests</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">TCP</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">9000-9999</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">Host level services, including the node exporter on ports 9100-9101 and the<br>&nbsp;Cluster Version Operator on port 9099</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">TCP</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">10250-10259</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">The default ports that Kubernetes reserves</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">TCP</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">10256</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">openshift-sdn</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">UDP</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">4789</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">VXLAN and Geneve</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">UDP</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">6081</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">VXLAN and Geneve</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">UDP</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">9000-9999</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">Host level services, including the node exporter on ports 9100-9101</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:1.0pt inset;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;">TCP/UDP</td>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">30000-32767</td>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">Kubernetes node port</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:1.0pt inset;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;">TCP</td>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">2379-2380</td>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">etcd server, peer, and metrics ports</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:1.0pt inset;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;">TCP</td>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">6443</td>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">Kubernetes API</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">22623</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">Bootstrap (temporary) and control plane nodes</td>
        <td style="border-bottom:1.0pt solid #DDDDDD;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">Machine Config server</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">443</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">Cluster nodes that run the Ingress router pods</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">&nbsp;</td>
      </tr>
      <tr>
        <td style="border-bottom:1.0pt inset;border-left:1.0pt inset;border-right:1.0pt inset;border-top:1.0pt none;padding:6.0pt;vertical-align:top;">80</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:87.8pt;">Cluster nodes that run the Ingress router pods</td>
        <td style="border-bottom:1.0pt inset;border-left:none;border-right:1.0pt inset;border-top:none;padding:6.0pt;vertical-align:top;width:721.0pt;">&nbsp;</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<h3 style="text-align:justify;"><strong>OpenShift Installation Modes</strong></h3>
<ol>
  <li style="text-align:justify;">connected: The cluster nodes have internet access to pull container images from the <code>quay.io</code> and <code>registry.redhat.io</code> registries.</li>
  <li style="text-align:justify;">disconnected: a local container registry to pull container images.</li>
</ol>
<h4><strong>Disconnected mode</strong></h4>
<p><strong>Prerequisites:</strong></p>
<ul>
  <li><mark class="marker-yellow">Internal registry</mark> that provide API-SCHEMA2 complaint APIs</li>
  <li>Use the <mark class="marker-yellow">exact version of images by using the digest instead of tags</mark></li>
  <li>The internal registry requires <mark class="marker-yellow">access to the internet to mirror the source images from the public registries</mark></li>
  <li><mark class="marker-blue">imageContentSources:&nbsp;</mark> To point to the source registry and the internal mirror, This customization will configure the file <code>/etc/containers/registries.conf</code> on each cluster node to enable image mirroring.</li>
</ul>
<p><strong>OpenShift clusters in restricted networks have the following limitations:</strong></p>
<ul>
  <li>The <code>ClusterVersion</code> status shows an <code>Unable to retrieve available updates error</code> message.</li>
  <li>By default, the Developer Catalog contents are unavailable because the cluster does not have access to the required image stream tags.</li>
  <li>The OpenShift Telemetry service is disabled.</li>
</ul>
<blockquote>
  <p>After mirroring the local container registry, start the OpenShift installation process. You must modify the <code>install-config.yaml</code> file to customize the disconnected OpenShift installation.</p>
</blockquote>
<pre><code class="language-plaintext">[user@demo ~]$ cat ${HOME}/ocp4-cluster/install-config.yaml
apiVersion: v1
baseDomain: example.com
#proxy: 1
#  httpProxy: http://&lt;username&gt;:&lt;pswd&gt;@&lt;ip&gt;:&lt;port&gt;
#  httpsProxy: http://&lt;username&gt;:&lt;pswd&gt;@&lt;ip&gt;:&lt;port&gt;
#  noProxy: example.com
compute:
- hyperthreading: Enabled
  name: worker
  replicas: 2
controlPlane:
  hyperthreading: Enabled
  name: master
  replicas: 3
metadata:
  name: ocp4
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16
platform:
  none: {}
fips: false
pullSecret: |
  {"auths":...output omitted...} 2
sshKey: |
  ssh-rsa AA...output omitted...
1- If required, you can use a network proxy in a connected installation.
2- The pull-secret contains the credentials to authenticate against quay.io and registry.redhat.io.

The following is a sample install-config.yaml file used in a disconnected installation:

[user@demo ~]$ cat ${HOME}/ocp4-cluster/install-config.yaml
apiVersion: v1
baseDomain: example.com
compute:
- hyperthreading: Enabled
  name: worker
  replicas: 2
controlPlane:
  hyperthreading: Enabled
  name: master
  replicas: 3
metadata:
  name: ocp4
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16
platform:
  none: {}
fips: false
pullSecret: |
  {"auths":...output omitted...} 
sshKey: |
  ssh-rsa AA...output omitted...
additionalTrustBundle: | 
  -----BEGIN CERTIFICATE-----
  ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ
  -----END CERTIFICATE-----
imageContentSources: 
- mirrors:
  - nexus-registry-int.apps.tools.dev.nextcle.com/openshift/ocp4
  source: quay.io/openshift-release-dev/ocp-release
- mirrors:
  - nexus-registry-int.apps.tools.dev.nextcle.com/openshift/ocp4
  source: quay.io/openshift-release-dev/ocp-v4.0-art-dev</code></pre>
<h3>named as DNS&nbsp;</h3>
<pre><code class="language-plaintext">cat /etc/named.conf
...output omitted...
zone "example.com" {
    type master;
    file "example.com.db";
    allow-update { none; };
};
...output omitted...</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">cat /var/named/example.com.db
$TTL  1D
@     IN  SOA dns.ocp4.example.com. root.example.com. (
                2019022400 ; serial
                3h         ; refresh
                15         ; retry
                1w         ; expire
                3h         ; minimum
              )
              IN NS dns.ocp4.example.com.
dns.ocp4      IN A 192.168.50.254
api.ocp4      IN A 192.168.50.254
api-int.ocp4  IN A 192.168.50.254
*.apps.ocp4   IN A 192.168.50.254
bootstrap.ocp4 IN A 192.168.50.9
master01.ocp4 IN A 192.168.50.10
master02.ocp4 IN A 192.168.50.11
master03.ocp4 IN A 192.168.50.12
worker01.ocp4 IN A 192.168.50.13
worker02.ocp4 IN A 192.168.50.14
</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">cat /etc/named.conf
...output omitted...
zone "50.168.192.in-addr.arpa" IN {
    type master;
    file "example.com.reverse.db";
    allow-update { none; };
};
...output omitted...</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">cat /var/named/example.com.reverse.db
$TTL  1D
@     IN  SOA dns.ocp4.example.com. root.example.com. (
                2019022400 ; serial
                3h         ; refresh
                15         ; retry
                1w         ; expire
                3h         ; minimum
              )
          IN NS dns.ocp4.example.com.
254  IN PTR api.ocp4.example.com.
254  IN PTR api-int.ocp4.example.com.
9  IN PTR bootstrap.ocp4.example.com.
10 IN PTR master01.ocp4.example.com.
11 IN PTR master02.ocp4.example.com.
12 IN PTR master03.ocp4.example.com.
13 IN PTR worker01.ocp4.example.com.
14 IN PTR worker02.ocp4.example.com.</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">sudo dnf install haproxy -y</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">#---------------------------------------------------------------------
# Example configuration for a possible web application.  See the
# full configuration options online.
#
#   https://www.haproxy.org/download/1.8/doc/configuration.txt
#
#---------------------------------------------------------------------

#---------------------------------------------------------------------
# Global settings
#---------------------------------------------------------------------
global
    # to have these messages end up in /var/log/haproxy.log you will
    # need to:
    #
    # 1) configure syslog to accept network log events.  This is done
    #    by adding the '-r' option to the SYSLOGD_OPTIONS in
    #    /etc/sysconfig/syslog
    #
    # 2) configure local2 events to go to the /var/log/haproxy.log
    #   file. A line like the following can be added to
    #   /etc/sysconfig/syslog
    #
    #    local2.*                       /var/log/haproxy.log
    #
    log         127.0.0.1 local2

    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon

    # turn on stats unix socket
    stats socket /var/lib/haproxy/stats

    # utilize system-wide crypto-policies
    #ssl-default-bind-ciphers PROFILE=SYSTEM
    #ssl-default-server-ciphers PROFILE=SYSTEM

#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    mode                    tcp
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 3000
#---------------------------------------------------------------------
# main frontend which proxys to the backends
#---------------------------------------------------------------------

frontend api
    bind &lt;LOADBALANCER_IP&gt;:6443
    default_backend controlplaneapi

frontend apiinternal
    bind &lt;LOADBALANCER_IP&gt;:22623
    default_backend controlplaneapiinternal

frontend secure
    bind &lt;LOADBALANCER_IP&gt;:443
    default_backend secure

frontend insecure
    bind &lt;LOADBALANCER_IP&gt;:80
    default_backend insecure

#---------------------------------------------------------------------
# static backend
#---------------------------------------------------------------------

backend controlplaneapi
    balance source
    server bootstrap &lt;BOOTSTRAP_IP&gt;:6443 check     # Can be removed or commented out after install completes
    server master0 &lt;MASTER0_IP&gt;:6443 check
    server master1 &lt;MASTER1_IP&gt;:6443 check
    server master2 &lt;MASTER2_IP&gt;:6443 check


backend controlplaneapiinternal
    balance source
    server bootstrap &lt;BOOSTRAP_IP&gt;:22623 check     # Can be removed or commented out after install completes
    server master0 &lt;MASTER0_IP&gt;:22623 check
    server master1 &lt;MASTER1_IP&gt;:22623 check
    server master2 &lt;MASTER2_IP&gt;:22623 check

backend secure
    balance source
    server compute0 &lt;COMPUTE0_IP&gt;:443 check
    server compute1 &lt;COMPUTE1_IP&gt;:443 check
    server compute2 &lt;COMPUTE2_IP&gt;:443 check

backend insecure
    balance source
    server worker0 &lt;COMPUTE0_IP&gt;:80 check
    server worker1 &lt;COMPUTE1_IP&gt;:80 check
    server worker2 &lt;COMPUTE2_IP&gt;:80 check</code></pre>
<p>&nbsp;</p>
