<!--
title: RBAC
description: 
published: true
date: 2025-12-14T13:51:19.701Z
tags: 
editor: ckeditor
dateCreated: 2025-12-14T13:18:30.230Z
-->

<ul>
  <li>PX-Security provides a method to protect against malicious requests, further providing deployers with a more secured system.</li>
</ul>
<ol>
  <li>Enable PX-security in the storagecluster spec to make the portworx operator deploy:<ul>
      <li>Shared Secret stored under the secret px-shared-secret</li>
      <li>Admin token stored under the secret px-admin-token</li>
      <li>User token stored under the secret px-user-token</li>
    </ul>
  </li>
</ol>
<pre><code class="language-plaintext">apiVersion: core.libopenstorage.org/v1
kind: StorageCluster
metadata:
  name: portworx
  namespace: &lt;px-namespace&gt;
spec:
  image: portworx/oci-monitor:2.6.0.1
  security:
    enabled: true</code></pre>
<p>&nbsp; 2. Use pxctl with security enabled:</p>
<ul>
  <li>Retrieve the admin token from the namespace in which Portworx was installed and store it in the <code>ADMIN_TOKEN</code> variable:</li>
</ul>
<pre><code class="language-plaintext">ADMIN_TOKEN=$(oc -n &lt;px-namespace&gt; get secret px-admin-token --template='{{index .data "auth-token" | base64decode}}')</code></pre>
<p>&nbsp;</p>
<ul>
  <li>Find the Portworx pod that is running on the node in which the admin wants to interact with and label it:</li>
</ul>
<pre><code class="language-plaintext">K8_NODE_NAME=kubernetes-worker-3.mylab.lan
PX_POD=$(oc -n &lt;px-namespace&gt; get pods -l name=portworx -o jsonpath="{.items[?(@.spec.nodeName == '$K8_NODE_NAME')].metadata.name}")</code></pre>
<p>&nbsp;</p>
<ul>
  <li>add the admin token to the pxctl context on that node</li>
</ul>
<pre><code class="language-plaintext">kubectl -n &lt;px-namespace&gt; exec -ti $PX_POD -- /opt/pwx/bin/pxctl context create admin --token=$ADMIN_TOKEN</code></pre>
<p>&nbsp; 3. Fetching the shared secret</p>
<pre><code class="language-plaintext">PORTWORX_AUTH_SHARED_SECRET=$(oc -n kube-system get \
        secret px-shared-secret -o json \
    | jq -r '.data."shared-secret"' \
    | base64 -d)</code></pre>
<p>&nbsp;4. copy the pxctl command from any worker node to the bastion host</p>
<p>&nbsp;5. Create a file called <code>admin.yaml</code> with the the following:</p>
<pre><code class="language-plaintext">name: Storage Administrator
email: the email of the storage admin
sub: ${uuid} or email of the storage admin
roles: ["system.admin"]
groups: ["*"]</code></pre>
<p>&nbsp; 6. Create a token for the storage administrator using <code>admin.yaml</code>.</p>
<pre><code class="language-plaintext">ADMIN_TOKEN=$(./pxctl auth token generate \
        --auth-config=admin.yaml \
        --issuer=portworx.com \
        --shared-secret=$PORTWORX_AUTH_SHARED_SECRET \
        --token-duration=1y)</code></pre>
<p>&nbsp; 7. add the token to the pxctl context on worker nodes</p>
<pre><code class="language-plaintext">/pxctl context create admin --token=$ADMIN_TOKEN</code></pre>
<p>&nbsp;</p>
