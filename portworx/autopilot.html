<!--
title: Autopilot
description: 
published: true
date: 2025-11-22T15:25:01.441Z
tags: 
editor: ckeditor
dateCreated: 2025-11-21T18:18:27.986Z
-->

<h1>Autopilot</h1>
<p>‚úî Autopilot is a rule-based automation engine in Portworx that responds to monitored<mark class="marker-yellow"> changes in a Kubernetes environment</mark>. It enables dynamic cluster management by <mark class="marker-yellow">automatically executing predefined actions when certain conditions are met.</mark></p>
<p>üëâüëâ Examples of the actions that can be executed:</p>
<ul>
  <li>Autopilot can be used to resize PVCs when they run low on capacity</li>
  <li>scale Portworx storage pools as usage grows</li>
  <li>rebalance volumes across storage pools to ensure optimal resource distribution</li>
</ul>
<p>üíÅ‚Äç‚ôÇÔ∏èüíÅ‚Äç‚ôÇÔ∏è As the autopilot depend on runtime changes in Kubernetes, it needs a metrics server.</p>
<figure class="image"><img src="/autopilot-overview-20cbb7be90d4981984165b911be90f88.gif">
  <figcaption>Autopilot workflow</figcaption>
</figure>
<p>&nbsp;</p>
<h2><strong>Autopilot Install and Setup</strong></h2>
<p>üò° Steps:</p>
<ol>
  <li>OpenShift Prometheus instance in your cluster from the OCP monitoring stack</li>
</ol>
<pre><code class="language-plaintext">oc get route thanos-querier -n openshift-monitoring -o json | jq -r '.spec.host'</code></pre>
<p>&nbsp;</p>
<blockquote>
  <p><strong>Thanos Querier:</strong> A stateless service that aggregates query requests and retrieves data from the Sidecars (for recent data) and the Store Gateway (for historical data).</p>
</blockquote>
<p>&nbsp; 2. ensure that the autopilot is enabled in the StorageCluster specification:</p>
<pre><code class="language-plaintext">kind: StorageCluster
spec:
  autopilot:
    enabled: true</code></pre>
<p>&nbsp; 3.<strong> </strong>Customize Autopilot install:</p>
<ul>
  <li>modify the spec part of StorageCluster:</li>
</ul>
<pre><code class="language-plaintext">apiVersion: core.libopenstorage.org/v1
kind: StorageCluster
...
spec:
  autopilot:
    enabled: true
    image: portworx/autopilot:1.3.14
    providers:
    - name: default
      params:
        url: https://&lt;THANOS-QUERIER-HOST&gt;   &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; routes from before 
      type: prometheus
    args:
      log-level: debug</code></pre>
<p>&nbsp;</p>
<ul>
  <li><strong>Here are all the parameters that could be modified:</strong></li>
</ul>
<figure class="table">
  <table>
    <thead>
      <tr>
        <th style="background-color:rgba(0, 0, 0, 0);border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><strong>Parameter</strong></th>
        <th style="background-color:rgba(0, 0, 0, 0);border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><strong>Default Value</strong></th>
        <th style="background-color:rgba(0, 0, 0, 0);border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><strong>Description</strong></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>stc.spec.Autopilot.args.log-level</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>info</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;">Determines the level of logs to be printed in Autopilot pod log. Can be set to <code>trace</code> or <code>debug</code> for troubleshooting.</td>
      </tr>
      <tr>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>stc.spec.Autopilot.args.min_poll_interval</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>5 (sec)</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;">Frequency at which Autopilot checks conditions for all rules and proceeds with state changes.</td>
      </tr>
      <tr>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>stc.spec.Autopilot.providers.name</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>default</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;">Name of the metrics provider.</td>
      </tr>
      <tr>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>stc.spec.Autopilot.providers.type</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>prometheus</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;">Type of the metrics provider, currently only <code>prometheus</code> is supported.</td>
      </tr>
      <tr>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>stc.spec.Autopilot.providers.params.url</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>http://px-prometheus:9090</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;">URL for the metrics provider where Autopilot scrapes volume/pool metrics. Default is the URL for Prometheus shipped with Portworx enterprise.</td>
      </tr>
      <tr>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>stc.spec.Autopilot.providers.params.ignore_unhealthy_targets</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>true</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;">Determines whether to ignore unhealthy scraping targets and proceed with Autopilot actions. If set to <code>false</code>, Autopilot won't proceed if there are unhealthy targets.</td>
      </tr>
      <tr>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;"><code>stc.spec.Autopilot.resources.limits.memory</code></td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;">&nbsp;</td>
        <td style="border-bottom:0.8px solid rgb(96, 103, 112);border-left:0.8px solid rgb(96, 103, 112);border-right:0.8px solid rgb(96, 103, 112);border-top:0.8px solid rgb(96, 103, 112);padding:12px;">Maximum memory size that can be claimed by Autopilot</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>&nbsp;</p>
<h3>‚öî <strong>Autopilot with PX-Security</strong></h3>
<blockquote>
  <p>PX-Security refers to the security features of the Portworx platform, providing <mark class="marker-yellow">Role-Based Access Control (RBAC</mark>), <mark class="marker-yellow">authentication</mark>, <mark class="marker-yellow">ownership</mark>, and volume encryption for Kubernetes environments</p>
</blockquote>
<ul>
  <li>Add the following PX_SHARED_SECRET env var to the <code>autopilot</code> section:</li>
</ul>
<pre><code class="language-plaintext">  autopilot:
...
    env:
    - name: PX_SHARED_SECRET
      valueFrom:
        secretKeyRef:
          key: apps-secret
          name: px-system-secrets</code></pre>
<h3>üöÄ <strong>Upgrade Autopilot</strong></h3>
<ul>
  <li>To upgrade Autopilot to a custom image:<ol>
      <li>Update the <code>configmap/px-versions</code> with the desired custom Autopilot image.</li>
      <li>Add the <code>autoUpdateComponents</code> field to the storage cluster specification:</li>
    </ol>
  </li>
</ul>
<pre><code class="language-plaintext">kind: StorageCluster
spec:
  autoUpdateComponents: Once</code></pre>
<p>&nbsp;</p>
<ul>
  <li>With Portworx Upgrade (without configmap):<ol>
      <li>Delete the <code>configmap/px-versions</code> file.<ul>
          <li>When Portworx is upgraded, the Operator will <mark class="marker-yellow">automatically upgrade the installed components to the recommended versions.</mark></li>
        </ul>
      </li>
      <li>Upgrade the Portworx image in the storage cluster specification to proceed with the upgrade.</li>
    </ol>
  </li>
  <li>With Portworx Upgrade (with configmap):<ol>
      <li>Download the latest Portworx version manifest:</li>
    </ol>
  </li>
</ul>
<pre><code class="language-plaintext">curl -o versions.yaml "https://install.portworx.com/$&lt;portworx-version&gt;/version?kbver=$&lt;kubernetes-version&gt;&amp;opver=$&lt;operator-version&gt;"</code></pre>
<p>&nbsp;</p>
<blockquote>
  <p><code>&lt;portworx_version&gt;</code> with the Portworx version you want to use.</p>
  <p><code>&lt;kubernetes-version&gt;</code> with the Kubernetes version you want to use.</p>
  <p><code>&lt;operator-version&gt;</code> with the Operator version you want to use.</p>
</blockquote>
<p>&nbsp; &nbsp; &nbsp;2. &nbsp;Update the px-versions configmap with the downloaded version manifest:</p>
<pre><code class="language-plaintext">kubectl -n &lt;px-namespace&gt; delete configmap px-versions
kubectl -n &lt;px-namespace&gt; create configmap px-versions --from-file=versions.yaml</code></pre>
<p>&nbsp; &nbsp; 3. Add the <code>autoUpdateComponents</code> field to the storage cluster specification:</p>
<pre><code class="language-plaintext">kind: StorageCluster
spec:
  autoUpdateComponents: Once </code></pre>
<h2><strong>Working with Autopilot Rules</strong></h2>
<p>ü§î what is <strong>AutopilotRule?</strong></p>
<ul>
  <li>It is <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">CRD</a> to tell Autopilot <mark class="marker-yellow">which </mark>objects to monitor, the <mark class="marker-yellow">conditions </mark>to monitor, and the corresponding <mark class="marker-yellow">actions </mark>to perform when conditions occur.</li>
  <li>An AutopilotRule has 4 main parts:<ol>
      <li><strong>Selector</strong> <mark class="marker-yellow">Matches labels on the objects</mark> that the rule should monitor.</li>
      <li><strong>Namespace Selector</strong> <mark class="marker-yellow">Matches labels on the Kubernetes namespaces the rule should monitor</mark>. This is optional, and the default is all namespaces.</li>
      <li><strong>Conditions</strong> The <mark class="marker-yellow">metrics for the objects to monitor.</mark></li>
      <li><strong>Actions</strong> to <mark class="marker-yellow">perform</mark> once the metric conditions are met.</li>
    </ol>
  </li>
</ul>
<h3><a href="https://docs.portworx.com/portworx-enterprise/operations/scale-portworx-cluster/autopilot/reference"><strong>Creating an AutopilotRule&nbsp;</strong></a></h3>
<pre><code class="language-plaintext">apiVersion: autopilot.libopenstorage.org/v1alpha1
kind: AutopilotRule
metadata:
 name: volume-resize
spec:
  ##### selector filters the objects affected by this rule given labels
  selector:
    matchLabels:
      app: postgres
  ##### namespaceSelector selects the namespaces of the objects affected by this rule
  namespaceSelector:
    matchLabels:
      type: db
  ##### conditions are the symptoms to evaluate. All conditions are AND'ed
  conditions:
    # volume usage should be less than 50%
    expressions:
    - key: "100 * (px_volume_fs_usage_bytes / px_volume_capacity_bytes)"
      operator: Gt
      values:
        - "50"
  ##### action to perform when condition is true
  actions:
  - name: openstorage.io.action.volume/resize
    params:
      # resize volume by scalepercentage of current size
      scalepercentage: "100"
      # volume capacity should not exceed 400GiB
      maxsize: "400Gi"</code></pre>
<p>&nbsp;</p>
<ul>
  <li>To monitor the autopilotRule:</li>
</ul>
<pre><code class="language-plaintext">oc get events --field-selector involvedObject.kind=AutopilotRule --all-namespaces</code></pre>
<h3><strong>Action approvals</strong></h3>
<p>üò® If you afraid of automating storage provisioning use manual approvals:</p>
<ul>
  <li>This is the workflow for a brave man:</li>
</ul>
<figure class="image image_resized" style="width:100%;"><img src="/aut-workflow-no-approval.png"></figure>
<ul>
  <li>This is the workflow of a wuss:<ul>
      <li>Create an AutopilotRule with <code>enforcement: approvalRequired</code> in the spec</li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">apiVersion: autopilot.libopenstorage.org/v1alpha1
kind: AutopilotRule
metadata:
  name: volume-resize
spec:
  #### enforcement indicates that actions from this rule need approval
  enforcement: approvalRequired</code></pre>
<p>&nbsp;</p>
<figure class="image image_resized" style="width:100%;"><img src="/aut-workflow-approval.png"></figure>
<p>&nbsp;</p>
<p>üò°üò°üò° approving the changes:</p>
<ol>
  <li>Once the conditions are met, list of the action approvals in the namespace. Identity the item in the list for the concerned object.</li>
  <li>Update the <code>approvalState</code> field in the ActionApproval object spec to <code>approved</code> or <code>declined</code>.</li>
</ol>
<pre><code class="language-plaintext">oc get events --field-selector involvedObject.kind=AutopilotRule,involvedObject.name=volume-resize -n default -w</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">oc get actionapproval -n namespace</code></pre>
<p>&nbsp;</p>
<ul>
  <li>Patch and approve the actionapproval:</li>
</ul>
<pre><code class="language-plaintext">oc patch actionapproval -n namespace actionapprovalName --type=merge -p '{"spec":{"approvalState":"approved"}}' </code></pre>
<ul>
  <li>Actions for the object will continue to stay in declined state until the <code>actionapproval</code> object is present and has approval state as declined. When you want Autopilot to resume monitoring this object, delete the actionapproval object.</li>
</ul>
<pre><code class="language-plaintext">oc delete actionapproval </code></pre>
<p>&nbsp;</p>
<h3>üò≠ <strong>Troubleshooting</strong></h3>
<p>For each object monitored by Autopilot, it will create a corresponding <code>autopilotruleobject</code> instance in the namespace of the object.</p>
<ul>
  <li>For volumes (PVCs), the <code>autopilotruleobject</code> instance will be in the namespace of the PVC.</li>
  <li>For storage pools, the <code>autopilotruleobject</code> instance will be in the namespace where Portworx is installed.</li>
</ul>
<p>The <code>autopilotruleobject</code> is created only if an object's condiitons were atleast triggered once. In other words, you will not see an <code>autopilotruleobject</code> if the object was always in nornal state.</p>
<pre><code class="language-plaintext">oc get aro --all-namespaces -l rule=rule_name</code></pre>
<h3><strong>Troubleshooting autopilot</strong></h3>
<ul>
  <li>Create a directory (<code>ap-cores</code>) in which to store your support bundle files and send the support signal to the autopilot process:</li>
</ul>
<pre><code class="language-plaintext">mkdir ap-cores
POD=$(oc get pods -n portworx -l name=autopilot | grep -v NAME | awk '{print $1}')
oc exec -n portworx $POD -- killall -SIGUSR1 autopilot</code></pre>
<p>&nbsp;</p>
<ul>
  <li>Copy the support bundle files from your Kubernetes cluster to your directory:</li>
</ul>
<pre><code class="language-plaintext">oc cp  portworx/$POD:/tmp/aut-diags.zip ap-cores/aut-diags.zipls ap-cores</code></pre>
<p>&nbsp;</p>
<ul>
  <li>Collect and place your autopilot pod logs into an <code>autopilot-pod.log</code> file within your temporary directory:</li>
</ul>
<pre><code class="language-plaintext">oc logs $POD -n portworx --tail=99999 &gt; ap-cores/autopilot-pod.log</code></pre>
<h1>Use Cases</h1>
<h2>Grow a PVC</h2>
<blockquote>
  <p>Autopilot does not support resizing FlashBlade Direct Access (FBDA) volumes. If you are using FBDA volumes, use the <code>kubectl edit pvc &lt;pvc-name&gt;</code> command and update the volume size in the <code>spec.resources.requests.storage</code> field to resize such volumes.</p>
</blockquote>
<pre><code class="language-plaintext">apiVersion: autopilot.libopenstorage.org/v1alpha1
kind: AutopilotRule
metadata:
 name: volume-resize
spec:
  ##### selector filters the objects affected by this rule given labels
  selector:
    matchLabels:
      app: postgres
  ##### namespaceSelector selects the namespaces of the objects affected by this rule
  namespaceSelector:
    matchLabels:
      type: db
  ##### conditions are the symptoms to evaluate. All conditions are AND'ed
  conditions:
    # volume usage should be less than 50%
    expressions:
    - key: "100 * (px_volume_fs_usage_bytes / px_volume_capacity_bytes)"
      operator: Gt
      values:
        - "50"
  ##### action to perform when condition is true
  actions:
  - name: openstorage.io.action.volume/resize
    params:
      # resize volume by scalepercentage of current size
      scalepercentage: "100"
      # volume capacity should not exceed 400GiB
      maxsize: "400Gi"</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">oc get events --field-selector involvedObject.kind=AutopilotRule,involvedObject.name=volume-resize \
--all-namespaces --sort-by .lastTimestamp</code></pre>
<h2><strong>Expand every Portworx storage pool in your cluster</strong></h2>
<ul>
  <li><strong>Only VMware is supported right now! And all public clouds as well.</strong></li>
  <li><strong>Depend on portworx cloud drivers</strong></li>
</ul>
<pre><code class="language-plaintext">apiVersion: autopilot.libopenstorage.org/v1alpha1
kind: AutopilotRule
metadata:
  name: pool-expand-till-400
spec:
  enforcement: required
  ##### conditions are the symptoms to evaluate.
  conditions:
    expressions:
    # pool size is less than 400 GiB
    - key: "px_pool_stats_total_bytes/(1024*1024*1024)"
      operator: Lt
      values:
        - "400"
  ##### action to perform when condition is true
  actions:
    - name: "openstorage.io.action.storagepool/expand"
      params:
        # resize pool by scalepercentage of current size. The 100% shown below will double the current pool size.
        scalepercentage: "100"
        # when scaling, add-drive/resize-drive to the pool based on available resources
        scaletype: "auto or add-drive or resize-drive"</code></pre>
<p>&nbsp;</p>
<blockquote>
  <p><a href="https://docs.portworx.com/portworx-enterprise/concepts/px-store-v2"><strong>PX-StoreV2</strong></a> supports scaling using only the <code>resize-drive</code> method. The <code>add-drive</code> method is not supported. If you select the <code>auto</code> scaling method, Portworx automatically uses <code>resize-drive</code> to scale the storage pool.</p>
</blockquote>
<h2><strong>Automatically expand Portworx storage pools</strong></h2>
<ul>
  <li><strong>same as above</strong></li>
</ul>
<pre><code class="language-plaintext">apiVersion: autopilot.libopenstorage.org/v1alpha1
kind: AutopilotRule
metadata:
  name: pool-expand
spec:
  enforcement: required
  ##### conditions are the symptoms to evaluate. All conditions are AND'ed.
  conditions:
    expressions:
    # Pool available capacity is less than 50%
    - key: "100 * (px_pool_stats_available_bytes / px_pool_stats_total_bytes)"
      operator: Lt
      values:
        - "50"
    # Total pool capacity should not exceed 400 GiB
    - key: "px_pool_stats_total_bytes / (1024 * 1024 * 1024)"
      operator: Lt
      values:
        - "400"
  ##### action to perform when conditions are true
  actions:
    - name: "openstorage.io.action.storagepool/expand"
      params:
        # Auto-scale the pool by a percentage of its current size
        scalepercentage: "50"
        # When scaling, use auto-scaling logic
        scaletype: "auto or add-drive or resize-drive"</code></pre>
<p>The <code>conditions</code> section establishes threshold criteria dictating when the rule must perform its action. In this example, that criteria contains two formulas:</p>
<ul>
  <li><code>100 * (px_pool_stats_available_bytes / px_pool_stats_total_bytes)</code>:<ul>
      <li>This calculates the percentage of available capacity in the pool.</li>
      <li>The <code>Lt</code> (less than) operator sets a condition that the pool‚Äôs available capacity percentage must be less than 50%.</li>
    </ul>
  </li>
  <li><code>px_pool_stats_total_bytes / (1024 * 1024 * 1024)</code>:<ul>
      <li>This calculates the total pool capacity in GiB.</li>
      <li>The Lt operator limits the pool size to a maximum of 400 GiB.</li>
    </ul>
  </li>
  <li>These conditions are combined using logical operator <code>AND</code>, meaning all conditions must be true for the rule to trigger.</li>
</ul>
<blockquote>
  <p>When you expand your storage pool using the <code>add-drive</code> scale type, Autopilot increases your pool storage capacity by adding new drives to the pool based on the scale percentage. The new drives will match the capacity of the existing ones because the storage pool consists of drives of equal size. For example, if your current pool consists of 100 GiB drive, with <code>add-drive</code> scale type, a 100 GiB drive is added to your pool, thus expanding it by 100%. In such cases, scale percentage represents the minimum percentage by which Portworx will scale up the pool. This note is only applicable if you are not using <a href="https://docs.portworx.com/portworx-enterprise/concepts/px-store-v2"><strong>PX-StoreV2</strong></a> as your backend.</p>
</blockquote>
<h2><strong>Automatically rebalance Portworx storage pools</strong></h2>
<pre><code class="language-plaintext">apiVersion: autopilot.libopenstorage.org/v1alpha1
kind: AutopilotRule
metadata:
  name: pool-rebalance
spec:
  conditions:
    requiredMatches: 1
    expressions:
    - keyAlias: PoolProvDeviationPerc
      operator: NotInRange
      values:
        - "-20"
        - "20"
    - keyAlias: PoolUsageDeviationPerc
      operator: NotInRange
      values:
        - "-20"
        - "20"
  actions:
    - name: "openstorage.io.action.storagepool/rebalance"</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">apiVersion: autopilot.libopenstorage.org/v1alpha1
kind: AutopilotRule
metadata:
  name: pool-rebalance
spec:
  conditions:
    requiredMatches: 1
    expressions:
    - key: 100 * (px_pool_stats_provisioned_bytes/ on (pool) px_pool_stats_total_bytes) 
      operator: Gt 
      values:
        - "120"
    - key: 100 * (px_pool_stats_used_bytes/ on (pool) px_pool_stats_total_bytes) 
      operator: Gt 
      values:
        - "70"
  actions:
    - name: "openstorage.io.action.storagepool/rebalance"</code></pre>
<p>&nbsp;</p>
<p><a href="https://docs.portworx.com/portworx-enterprise/operations/scale-portworx-cluster/autopilot/reference"><span class="text-huge" style="font-family:'Lucida Sans Unicode', 'Lucida Grande', sans-serif;"><strong>The reference for the specs, events, and others</strong></span></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
