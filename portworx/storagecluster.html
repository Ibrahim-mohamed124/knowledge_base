<!--
title: StorageCluster
description: 
published: true
date: 2025-12-10T06:26:24.387Z
tags: portworx
editor: ckeditor
dateCreated: 2025-12-10T06:00:09.013Z
-->

<ul>
  <li>The StorageCluster object acts as the definition of the Portworx Cluster.</li>
  <li>To configure portworx to use all the unused devices for storage</li>
</ul>
<pre><code class="language-plaintext">apiVersion: core.libopenstorage.org/v1
kind: StorageCluster
metadata:
  name: portworx
  namespace: &lt;px-namespace&gt;
spec:
  image: portworx/oci-monitor:3.0
  kvdb:
    internal: true
  storage:
    useAll: true</code></pre>
<p>&nbsp;</p>
<ul>
  <li>External ETCD</li>
</ul>
<pre><code class="language-plaintext">apiVersion: core.libopenstorage.org/v1
kind: StorageCluster
metadata:
  name: portworx
  namespace: &lt;px-namespace&gt;
spec:
  image: portworx/oci-monitor:3.0
  kvdb:
    endpoints:
    - etcd:http://etcd-1.net:2379
    - etcd:http://etcd-2.net:2379
    - etcd:http://etcd-3.net:2379
    authSecret: px-kvdb-auth
  stork:
    enabled: true
    args:
      health-monitor-interval: "100"
      webhook-controller: "true"</code></pre>
<p>&nbsp;</p>
<ul>
  <li>to enable PX-Security and disallow any user to access to portworx volumes unless they have a token</li>
</ul>
<pre><code class="language-plaintext">apiVersion: core.libopenstorage.org/v1
kind: StorageCluster
metadata:
  name: portworx
  namespace: &lt;px-namespace&gt;
spec:
  image: portworx/oci-monitor:3.0
  security:
    enabled: true
    auth:
      guestAccess: 'Disabled'
      selfSigned:
        issuer: 'openstorage.io'
        sharedSecret: 'px-shared-secret'
        tokenLifetime: '5d</code></pre>
<p>&nbsp;</p>
<ul>
  <li>To use PX-storeV2 instead of V1 add this annotation <mark class="marker-yellow">portworx.io/misc-args: ' -T px-storev2 '</mark></li>
  <li>To skip preflight check job add this annotation <mark class="marker-yellow">portworx.io/preflight-check: skip </mark>and add the<mark class="marker-yellow"> cloudStorage.systemMetadataDeviceSpec: size=64 </mark>filed</li>
</ul>
<pre><code class="language-plaintext">apiVersion: core.libopenstorage.org/v1
kind: StorageCluster
metadata:
  name: portworx
  namespace: &lt;px-namespace&gt;
  annotations:
      portworx.io/misc-args: ' -T px-storev2 '
      portworx.io/preflight-check: skip
spec:
  image: portworx/oci-monitor:3.0
  cloudStorage:
      systemMetadataDeviceSpec: size=64</code></pre>
<ul>
  <li>update strategy and delete strategy&nbsp;</li>
</ul>
<pre><code class="language-plaintext">apiVersion: core.libopenstorage.org/v1
kind: StorageCluster
metadata:
  name: portworx
  namespace: &lt;px-namespace&gt;
spec:
  image: portworx/oci-monitor:3.0
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 20%
  deleteStrategy:
    type: UninstallAndWipe
  placement:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: px/enabled
            operator: NotIn
            values:
            - "false"
          - key: node-role.kubernetes.io/control-plane
            operator: DoesNotExist
          - key: node-role.kubernetes.io/worker
            operator: Exists
    tolerations:
    - key: infra/node
      operator: Equal
      value: "true"
      effect: NoExecute</code></pre>
<ul>
  <li>Portworx with node specific overrides. Use different devices or no devices on different set of nodes.</li>
</ul>
<pre><code class="language-plaintext">apiVersion: core.libopenstorage.org/v1
kind: StorageCluster
metadata:
  name: portworx
  namespace: &lt;px-namespace&gt;
spec:
  image: portworx/oci-monitor:3.0
  storage:
    devices:
    - /dev/mapper/
    - /dev/disk/by-id/
    - /dev/sdb
  nodes:
  - selector:
      labelSelector:
        matchLabels:
          &lt;custom-key&gt;:"&lt;custom-value&gt;"
    storage:
      devices:
      - /dev/nvme1
      - /dev/nvme2
  - selector:
      labelSelector:
        matchLabels:
          &lt;custom-key&gt;:"&lt;custom-value&gt;"
    storage:
      devices: []</code></pre>
