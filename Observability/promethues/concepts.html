<!--
title: Concepts
description: 
published: true
date: 2026-01-26T15:36:47.931Z
tags: 
editor: ckeditor
dateCreated: 2026-01-19T11:20:24.899Z
-->

<h1>Intro to Observability</h1>
<ul>
  <li>The ability to understand and measure the state of a system based upon data generated by the system</li>
  <li>It allows to generate actionable outputs from unexpected scenarios in dynamic environments and help in<ul>
      <li>Better insights into the internal working of a system</li>
      <li>speed up troubleshooting</li>
      <li>Monitor performance</li>
    </ul>
  </li>
  <li>Unlike monolithic application microservices applications are much more complex</li>
  <li>it gives us answers for<ul>
      <li>error rates</li>
      <li>high latency</li>
      <li>timing outs</li>
    </ul>
  </li>
</ul>
<h3>Pillars of Observability</h3>
<ol>
  <li>logging:<ul>
      <li>Records of events that have occurred and encapsulated information about the specific event with timestamps</li>
    </ul>
  </li>
  <li>metrics:<ul>
      <li>numeric data about the system that contain:<ul>
          <li>Metric name</li>
          <li>Value of the metric</li>
          <li>Timestamp</li>
          <li>Dimensions: more data about the mertic</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Traces:<ul>
      <li>allow to follow operations as they traverses through various systems &amp; services hop by hop to understand the whole picture<ul>
          <li>trace ID: the unique id for a trace</li>
          <li>Spans: evens in the trace and contain start time of the span, duration, and parent id</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>
<h3>Quality of Service indicators</h3>
<ol>
  <li>measurable targets/goals to help organizations strike the right balance between product development and operations work.<ul>
      <li>SLI: service level indicator is a quantitative measure of some aspect of the level of service that is provided like request latency, error rate, saturation, throughput, and availability.<ul>
          <li>Metrics that accurately measure the user's experience.</li>
        </ul>
      </li>
      <li>SLO: service level objective - target value or range &nbsp;of an SLI</li>
      <li>SLA: service level agreement: &nbsp;Contract between end user and provider to meet the SLO</li>
    </ul>
  </li>
</ol>
<h2>Prometheus</h2>
<h3>Use cases</h3>
<ul>
  <li>collect metrics from many datacenters</li>
  <li>alerting when conditions are met</li>
  <li>scrape and do operations in metrics.</li>
  <li>data charting</li>
</ul>
<h3>Basics</h3>
<ul>
  <li>Prometheus collects metrics by scraping targets who expose metrics through an HTTP endpoint</li>
  <li>Store the scraped metrics into time based database</li>
</ul>
<h6>Architecture</h6>
<ol>
  <li>Data retrieval workers: &nbsp;scrape the data from the target endpoints by sending http requests ( pulling metrics )</li>
  <li>TSDB: &nbsp;stores the metric data</li>
  <li>HTTP server: accepts PromeQL Query</li>
  <li>Exporters: runs on the targets so data retrieval can scrape the metrics</li>
  <li>Push Gateway: for short lived jobs that cannot wait till the data retrievals pull the metrics so the gateway pushes stores the metrics till the data retrieval workers pull the data</li>
  <li>Service Discovery: Dynamically update the list of target to monitor</li>
  <li>Alert manager: to send alerts</li>
</ol>
<figure class="image"><img src="/observability/arch.png"></figure>
<p>&nbsp;</p>
<h6>Collecting Metrics</h6>
<ul>
  <li>Prometheus collects metrics by sending http requests to /metrics endpoint of each target by default</li>
  <li>If the system has no metrics endpoint use exporter process to collect metrics and exposing /metrics endpoint</li>
  <li>client libraries allow to expose any application metrics for promethues for different languages like go and python</li>
</ul>
<h3>Prometheus configuration</h3>
<ul>
  <li>conf file is prometheus.yaml in the prometheus-server configmap</li>
</ul>
<pre><code class="language-plaintext">  prometheus.yml: |
    global:                  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; for all the scrape_configs to inherit
      evaluation_interval: 1m
      scrape_interval: 1m
      scrape_timeout: 10s
    scrape_configs:              &gt;&gt;&gt;&gt;&gt;&gt;  Define targets &amp; configs for metrics collection

    - job_name: kubernetes-nodes &gt;&gt;&gt;&gt;&gt;&gt;  a collection of instance that need to be scraped 

      scrape_interval: 10s       &gt;&gt;&gt;&gt;&gt;&gt; override the global config
      bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
      kubernetes_sd_configs:
      - role: node
      relabel_configs:
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)
      - replacement: kubernetes.default.svc:443
        target_label: __address__
      - regex: (.+)
        replacement: /api/v1/nodes/$1/proxy/metrics
        source_labels:
        - __meta_kubernetes_node_name
        target_label: __metrics_path__
      scheme: https
      tls_config:
        ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
     - job_name: prometheus
      static_configs:
      - targets:                &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; endpoints to be scraped 
        - localhost:9090

    rule_files:
    - /etc/config/recording_rules.yml
    - /etc/config/alerting_rules.yml
    - /etc/config/rules
    - /etc/config/alerts
    alerting:
      alertmanagers:
      - kubernetes_sd_configs:
          - role: pod
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        relabel_configs:
        - source_labels: [__meta_kubernetes_namespace]
          regex: prome
          action: keep
        - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_instance]
          regex: prometheus-1768820394
          action: keep
        - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_name]
          regex: alertmanager
          action: keep
        - source_labels: [__meta_kubernetes_pod_container_port_number]
          regex: "9093"
          action: keep
    storage: {}</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">  - job_name: "nodes"
    static_configs:
      - targets: ["node01:9100"]
        labels:
          node: "node01"
      - targets: ["node02:9100"]
        labels:
          node: "node02"</code></pre>
<p>&nbsp;</p>
<blockquote>
  <p>In Prometheus version 3.5.0 and above, the <code>consoles/</code> and <code>console_libraries/</code> directories have been removed from the distribution tarball.</p>
</blockquote>
<h3>Installation as systemd services</h3>
<ul>
  <li>Install the binary from the official docs&nbsp;</li>
</ul>
<pre><code class="language-plaintext">wget https://github.com/prometheus/prometheus/releases/download/v3.9.1/prometheus-3.9.1.linux-amd64.tar.gz</code></pre>
<ul>
  <li>unarchive the tar file</li>
</ul>
<pre><code class="language-plaintext"> tar -xvaf prometheus-3.9.1.linux-amd64.tar.gz</code></pre>
<ul>
  <li>create a user for prometheus without a login shell</li>
</ul>
<pre><code class="language-plaintext">useradd -no-create-home --shell /bin/false prometheus</code></pre>
<ul>
  <li>make the configuration and data directories</li>
</ul>
<pre><code class="language-plaintext">mkdir /etc/prometheus &amp;&amp; mkdir /var/lib/prometheus
chown prometheus:prometheus /etc/prometheus &amp;&amp; chown prometheus:promethues /var/lib/promethues</code></pre>
<ul>
  <li>move prometheus and promtool binaries &nbsp;to /usr/local/bin/ and change ownership</li>
</ul>
<pre><code class="language-plaintext">mv prometheus promtool /usr/local/bin/ &amp;&amp; chown prometheus:prometheus /usr/local/bin/prometheus /usr/local/bin/promtool</code></pre>
<ul>
  <li>move prometheus.yaml to /etc/prometheus/ and change ownership</li>
  <li>create the service file</li>
</ul>
<pre><code class="language-plaintext">[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
   --config.file /etc/prometheus/prometheus.yml \
   --storage.tsdb.path /var/lib/prometheus/     \

[Install]
WantedBy=multi-user.target</code></pre>
<ul>
  <li>copy the file to the /etc/systemd/system/promethues.service and enable the service</li>
</ul>
<h3>Install the node exporter as a systemd</h3>
<ul>
  <li>get the binary and unarchieve&nbsp;</li>
</ul>
<pre><code class="language-plaintext">https://github.com/prometheus/node_exporter/releases/download/v1.10.2/node_exporter-1.10.2.linux-amd64.tar.gz</code></pre>
<ul>
  <li>create a user and move the binary to /etc/local/bin then change ownership</li>
  <li>create the systemd service</li>
</ul>
<pre><code class="language-plaintext">[Unit]
Description=Node Exporter
Wants=network-online.target
After=network-online.target
[Service]
User=node_exporter
Group=node_exporter
Type=simple
ExecStart=/usr/local/bin/node_exporter
[Install]
WantedBy=multi-user.target</code></pre>
<p>&nbsp;</p>
