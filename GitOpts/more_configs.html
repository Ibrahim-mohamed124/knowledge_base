<!--
title: More_configs
description: 
published: true
date: 2025-12-31T11:25:40.247Z
tags: 
editor: ckeditor
dateCreated: 2025-12-31T04:37:31.808Z
-->

<h3>RBAC</h3>
<ul>
  <li>policies are defined in CSV notation and applied to a user or a group</li>
</ul>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td>Project Level objects like applications, logs, exec</td>
        <td>p(policy), &lt;role/user/group&gt;, &nbsp;&lt;resource&gt;,&lt;action&gt;, &lt;project/object&gt;, &lt;effect&gt;</td>
        <td>g(group), user/group, role</td>
      </tr>
      <tr>
        <td>Other resources&nbsp;</td>
        <td>p(policy), &lt;role/user/group&gt;, &nbsp;&lt;resource&gt;,&lt;action&gt;, &lt;object&gt;, &lt;effect&gt;</td>
        <td>g(group), user/group, role</td>
      </tr>
    </tbody>
  </table>
</figure>
<ul>
  <li>Add RBAC policies to the argocd-rbac-cm</li>
  <li>argocd has two built in policies admin, readonly</li>
</ul>
<pre><code class="language-plaintext">kubectl -n argocd patch configmap argocd-rbac-cm \
--patch='{"data": {"policy.csv": "p, role:create-cluster, clusters, create, *, allow\ng, username, role:create-cluster"}}' </code></pre>
<pre><code class="language-plaintext">argocd account can-i create clusters '*'</code></pre>
<p>&nbsp;</p>
<blockquote>
  <p>the \n is for new line</p>
  <p>g(<strong>Group)</strong>: Allows to assign authenticated users/groups to internal roles.</p>
</blockquote>
<pre><code class="language-plaintext">apiVersion: v1
data:
  policy.csv: |-
    p, role:create-cluster, clusters, create, *, allow
    g, test, role: create-cluster
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/name: argocd-rbac-cm
    app.kubernetes.io/part-of: argocd
  name: argocd-rbac-cm
  namespace: argocd</code></pre>
<p>&nbsp;</p>
<ul>
  <li>Argocd supports local users and SSO using dex okta connector</li>
  <li>Local users are stored in argocd-cm by accounts.username: apikey, login and accouts.SID.enabled: “false”</li>
</ul>
<pre><code class="language-plaintext">kubectl -n argocd patch configmap argocd-cm --patch='{"data": {"accounts.username": "apiKey, login"}}' </code></pre>
<pre><code class="language-plaintext">apiVersion: v1
data:
  accounts.test: apiKey, login
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
  name: argocd-cm
  namespace: argocd</code></pre>
<p>&nbsp;</p>
<ul>
  <li>use argocd account to update a password</li>
</ul>
<pre><code class="language-plaintext">argocd account update-password --account test --new-passowrd --current-password=admin passowrd</code></pre>
<p>&nbsp;</p>
<ul>
  <li>To set a default role for any user who is not mapped to another roles</li>
</ul>
<pre><code class="language-plaintext">kubectl -n argocd patch cm argocd-rbac-cm --patch='{"data": {"policy.default": "role: readonly"}}'</code></pre>
<h3>Bitnami Sealed secrets</h3>
<ul>
  <li>Only the controller running in the target cluster can decrypt the sealed secret&nbsp;</li>
  <li>kubeseal client can be used to encrypt secrets&nbsp;</li>
</ul>
<pre><code class="language-plaintext">kubeseal -o yaml --scope cluster-wide --cert sealedsecret.crt &lt; secret.yaml &gt; sealedsecret.yaml</code></pre>
<ul>
  <li>Installation via helm chart https://bitnami-labs.github.io/sealed-secrets in the kube-system namespace</li>
  <li>Install the cli</li>
</ul>
<pre><code class="language-plaintext"># Fetch the latest sealed-secrets version using GitHub API
KUBESEAL_VERSION=$(curl -s https://api.github.com/repos/bitnami-labs/sealed-secrets/tags | jq -r '.[0].name' | cut -c 2-)

# Check if the version was fetched successfully
if [ -z "$KUBESEAL_VERSION" ]; then
    echo "Failed to fetch the latest KUBESEAL_VERSION"
    exit 1
fi

curl -OL "https://github.com/bitnami-labs/sealed-secrets/releases/download/v${KUBESEAL_VERSION}/kubeseal-${KUBESEAL_VERSION}-linux-amd64.tar.gz"
tar -xvzf kubeseal-${KUBESEAL_VERSION}-linux-amd64.tar.gz kubeseal
sudo install -m 755 kubeseal /usr/local/bin/kubeseal</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
