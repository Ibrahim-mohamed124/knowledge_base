<!--
title: Anthos Recommended Features Migration
description: 
published: true
date: 2026-02-15T20:11:55.977Z
tags: 
editor: ckeditor
dateCreated: 2026-02-15T19:53:45.620Z
-->

<h1>Admin Cluster</h1>
<h2>Key rotation</h2>
<ul>
  <li>To migrate from Non-HA to HA, first rotate the encryption key if always-on secret encryption is enabled</li>
  <li>To rotate an existing encryption key for a cluster, increment the <code>keyVersion</code> in the corresponding <a href="https://docs.cloud.google.com/kubernetes-engine/distributed-cloud/vmware/docs/how-to/admin-cluster-configuration-file-latest#secretsencryption-generatedkey-version-field">admin cluster configuration file</a> or <a href="https://docs.cloud.google.com/kubernetes-engine/distributed-cloud/vmware/docs/how-to/user-cluster-configuration-file-latest#secretsencryption-generatedkey-version-field">user cluster configuration file</a>, and run the appropriate <code>gkectl update</code> command.</li>
  <li>This creates a new key matching the new version number, re-encrypts each secret, and securely erases the old one. All subsequent new secrets are encrypted using the new encryption key.</li>
</ul>
<pre><code class="language-plaintext">secretsEncryption:
  mode: GeneratedKey
  generatedKey:
    keyVersion: New Version
    disabled: true</code></pre>
<ul>
  <li>update the cluster</li>
</ul>
<pre><code class="language-plaintext">gkectl update --config cluster-config.yaml --kubeconfig kubeconfig_admin_cluster</code></pre>
<blockquote>
  <p>The Kubernetes API access is unavailable for non-HA admin clusters for about 20 minutes</p>
</blockquote>
<h2>HA&nbsp;</h2>
<h3>Allocate additional IP addresses</h3>
<ul>
  <li>When migrating the admin cluster from non-HA to HA, allocate four additional IP addresses. Ensure these IP addresses are in the same VLAN as the existing admin cluster nodes and aren't already used by any existing nodes:<ul>
      <li>Allocate one IP address for the new control plane VIP, for the <a href="https://docs.cloud.google.com/kubernetes-engine/distributed-cloud/vmware/docs/how-to/admin-cluster-configuration-file-latest#loadbalancer-vips-controlplanevip-field"><code>loadBalancer.vips.controlPlaneVIP</code></a> field in the admin cluster configuration file.</li>
      <li>Allocate a new IP addresses for each of the three control-plane nodes, for the <a href="https://docs.cloud.google.com/kubernetes-engine/distributed-cloud/vmware/docs/how-to/admin-cluster-configuration-file-latest#loadbalancer-vips-controlplanevip-field"><code>network.controlPlaneIPBlock</code></a> section in the admin cluster configuration file.</li>
    </ul>
  </li>
</ul>
<h3>Rotate the Encryption key</h3>
<ul>
  <li>check if the encryption key is not rotated</li>
</ul>
<pre><code class="language-plaintext">kubectl --kubeconfig ADMIN_CLUSTER_KUBECONFIG get secret -n kube-system admin-master-component-options -o jsonpath='{.data.data}' | base64 -d | grep -oP '"GeneratedKeys":\[.*?\]'</code></pre>
<ul>
  <li>If the output shows an empty key, such as in the following example, you must rotate the encryption key</li>
</ul>
<pre><code class="language-plaintext">"GeneratedKeys":[{"KeyVersion":"1","Key":""}]</code></pre>
<h3>Update the admin cluster configuration file</h3>
<pre><code class="language-plaintext">vCenter:
  address: "my-vcenter-server.my-domain.example"
  datacenter: "my-data-center"
  dataDisk: "xxxx.vmdk"
...
network:
  hostConfig:
    dnsServers:
    - 203.0.113.1
    - 203.0.113.2
    ntpServers:
    - 203.0.113.3
  ...
  controlPlaneIPBlock:
    netmask: "255.255.255.0"
    gateway: "198.51.100.1"
    ips:
    - ip: "192.0.2.1"
      hostname: "admin-cp-hostname-1"
    - ip: "192.0.2.2"
      hostname: "admin-cp-hostname-2"
    - ip: "192.0.2.3"
      hostname: "admin-cp-hostname-3"
...

...
adminMaster:
  replicas: 3
  cpus: 4
  memoryMB: 8192
...</code></pre>
