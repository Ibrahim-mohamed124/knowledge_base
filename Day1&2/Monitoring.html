<!--
title: Monitoiring
description: 
published: true
date: 2025-12-12T09:30:49.106Z
tags: 
editor: ckeditor
dateCreated: 2025-11-28T07:44:41.035Z
-->

<h1>OpenShift Observability</h1>
<ul>
  <li><strong>OpenShift Logging: </strong>Red&nbsp;Hat OpenShift Logging <mark class="marker-yellow">aggregates all the logs</mark> from the pods and nodes of an OpenShift cluster to a centralized location. Centralized logging improves searching, visualizing, and reporting of data.</li>
  <li><strong>OpenShift Monitoring: </strong>Red&nbsp;Hat OpenShift Monitoring<mark class="marker-yellow"> provides monitoring for core platform components</mark>.</li>
  <li><strong>Network Observability: </strong>Network observability monitors and<mark class="marker-yellow"> analyzes network traffic and helps to resolve connectivity issues.</mark></li>
  <li><strong>Distributed Tracing: </strong>Distributed tracing <mark class="marker-yellow">collects observability data in distributed systems. </mark>Distributed tracing is based on the OpenTelemetry project.</li>
</ul>
<h3>OpenShift Monitoring</h3>
<ul>
  <li>The cluster monitoring operator manages the monitoring components and ensures that they are always available and updated.</li>
  <li>The default monitoring stack does not support custom metrics for user-defined projects.</li>
  <li>Optionally, it is possible to configure custom metrics for user-defined projects and to configure persistent storage to have history of metrics.</li>
</ul>
<h3>OpenShift Monitoring Stack</h3>
<ul>
  <li>The OpenShift monitoring stack is based on the Prometheus open source project.</li>
</ul>
<figure class="image image_resized" style="width:100%;"><img src="/monitoring-architecture.svg"></figure>
<ol>
  <li>All components of the default monitoring stack are installed in the <code>openshift-monitoring</code> project and provide monitoring features for core platform components.<ul>
      <li><mark class="marker-yellow">Modifying any existing resource and creating additional </mark><code>ServiceMonitor</code>, <code>PodMonitor</code>, or <code>PrometheusRule</code> <mark class="marker-yellow">resources </mark>in the <code>openshift-monitoring</code> <mark class="marker-yellow">project is not supported</mark>.</li>
      <li><strong>Cluster Monitoring Operator:</strong>
        <ul>
          <li>The cluster monitoring operator controls the deployed monitoring components and ensures that they are always in sync with the latest version of the cluster monitoring operator.</li>
        </ul>
      </li>
      <li><strong>Prometheus Operator:</strong>
        <ul>
          <li>The Prometheus operator deploys and configures both <mark class="marker-yellow">Prometheus </mark>and <mark class="marker-yellow">Alertmanager</mark>. The operator also manages the generation of configuration targets (service monitors and pod monitors).</li>
        </ul>
      </li>
      <li><strong>Prometheus Adapter:</strong>
        <ul>
          <li><mark class="marker-yellow">The Prometheus adapter exposes cluster resources for Horizontal Pod Autoscaling (HPA).</mark></li>
        </ul>
      </li>
      <li><strong>Kube state metrics:</strong>
        <ul>
          <li>The <code>kube-state-metrics</code> converter agent <mark class="marker-yellow">exports Kubernetes objects to metrics that Prometheus can parse.</mark></li>
        </ul>
      </li>
      <li><strong>OpenShift state metrics:</strong>
        <ul>
          <li>The <code>openshift-state-metrics</code> agent is based on the <code>kube-state-metrics</code> agent and adds monitoring for OpenShift-specific resources (such as image registry metrics).</li>
        </ul>
      </li>
      <li><strong>Node exporter:</strong>
        <ul>
          <li>The <code>node-exporter</code> agent exports <mark class="marker-yellow">low-level metrics for compute nodes.</mark></li>
        </ul>
      </li>
      <li><strong>Thanos Querier:</strong>
        <ul>
          <li>Thanos Querier is a single, multitenant interface that enables <mark class="marker-yellow">aggregating and deduplicating cluster and user workload metrics.</mark></li>
        </ul>
      </li>
      <li><strong>Telemeter Client:</strong>
        <ul>
          <li>Telemeter Client sends a data portion from Prometheus instances to Red&nbsp;Hat for remote health monitoring.</li>
        </ul>
      </li>
      <li><strong>The monitoring web console:</strong>
        <ul>
          <li>The OpenShift Container Platform web console provides the <strong>Observe</strong> section to access and manage monitoring features. In the Observe section, you can access monitoring dashboards, metrics, alerts, and metrics targets.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>The monitoring components for user-defined projects are installed in the <code>openshift-user-workload-monitoring</code> project.<ul>
      <li>Prometheus Operator</li>
      <li>Prometheus</li>
      <li>Thanos Ruler</li>
      <li>Alertmanager</li>
    </ul>
  </li>
</ol>
<h4>Prometheus</h4>
<ul>
  <li>Prometheus gathers and <mark class="marker-yellow">stores streams of data from the cluster as </mark><i><mark class="marker-yellow">time-series data</mark></i>. Time-series data consists of a sequence of samples, where <mark class="marker-yellow">each sample contains the following elements:</mark>
    <ul>
      <li>A timestamp</li>
      <li>A numeric value (such as an integer, float, or Boolean)</li>
      <li>A set of labels in the form of key/value pairs</li>
    </ul>
  </li>
  <li>The <mark class="marker-yellow">key/value pairs isolate groups of related values for filtering.</mark></li>
  <li>The OpenShift has three monitoring stack components to <mark class="marker-yellow">gather the metrics from the Kubernetes API</mark>: the <code>kube-state-metrics</code>, <code>openshift-state-metrics</code>, and <code>node-exporter</code> agents.</li>
  <li>Prometheus Query Language provides several <mark class="marker-yellow">operators </mark>to compute new time-series metrics like arithmetic and comparison operators, and also it contains some<mark class="marker-yellow"> built-in functions.</mark></li>
</ul>
<pre><code class="language-plaintext">node_memory_MemAvailable_bytes/node_memory_MemTotal_bytes*100&lt;50
Shows nodes with less than 50% of available memory.

kube_persistentvolumeclaim_status_phase{phase="Pending"} == 1
Shows persistent volume claims in the pending state.</code></pre>
<p>&nbsp;</p>
<ul>
  <li>The Red&nbsp;Hat add-on operators can define extra metrics and alerts. For example, the <code>compliance</code> operator exposes additional metrics to Prometheus. You can get a list of exposed metrics by using the following query:</li>
</ul>
<pre><code class="language-plaintext">{name=~"compliance.*"}</code></pre>
<h3>Enabling monitoring for user-defined projects</h3>
<p>&nbsp;</p>
<pre><code class="language-plaintext">oc -n openshift-monitoring edit configmap cluster-monitoring-config</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-monitoring-config
  namespace: openshift-monitoring
data:
  config.yaml: |
    enableUserWorkload: true </code></pre>
<h3>Exclude namespaces from the monitoring</h3>
<pre><code class="language-plaintext">oc label namespace &lt;namespace_name&gt; openshift.io/user-monitoring=false </code></pre>
<h2>Alerts and Notifications</h2>
<ul>
  <li>Use the Alerts UI to manage alerts, silences, and alerting rules.<ul>
      <li><strong>Alerting rules: </strong>Alerting rules contain <mark class="marker-yellow">a set of conditions</mark> that outline a particular state within a cluster. Alerts are triggered when those conditions are true. An alerting rule can be<mark class="marker-yellow"> assigned a severity</mark> that <mark class="marker-yellow">defines how the alerts are routed</mark>.</li>
      <li><strong>Alerts: </strong>An alert is fired when the<mark class="marker-yellow"> conditions that are defined in an alerting rule are true</mark>. Alerts notify that a set of conditions apply in an OpenShift Container Platform cluster.</li>
      <li><strong>Alert receivers: </strong>You can configure the alerting system to<mark class="marker-yellow"> route alerts to a receiver and send notifications via email, send pager notifications, or forward them to another system by using a webhook.</mark></li>
      <li><strong>Silences: </strong>A silence can be<mark class="marker-yellow"> applied to an alert to prevent sending notifications when the conditions for an alert are true</mark>. You can mute an alert after the initial notification, while you work on resolving the underlying issue.</li>
    </ul>
  </li>
  <li>Users with <code>user-workload-monitoring-config-edit</code> role in the <code>openshift-user-workload-monitoring</code> project can configure their alerts</li>
</ul>
<h3>Sending Alert Notifications</h3>
<ul>
  <li>Alerts <mark class="marker-yellow">are not configured by default to be sent to any notification systems</mark>. You can configure OpenShift Container Platform to send alerts to the following receiver types:<ul>
      <li>Email</li>
      <li>PagerDuty</li>
      <li>Slack</li>
      <li>Webhook</li>
    </ul>
  </li>
  <li>The <mark class="marker-yellow">Alertmanager configuration</mark> is saved in the <code>alertmanager-main</code> secret in the <code>openshift-monitoring</code> namespace.</li>
</ul>
<pre><code class="language-plaintext">oc extract secret/alertmanager-main -n openshift-monitoring \
  --to ./ --confirm</code></pre>
<p>&nbsp;</p>
<ul>
  <li>sed script to clean the many quotes in the secret <code><strong>sed -f script.sed alertmanager.yaml</strong></code></li>
</ul>
<pre><code class="language-plaintext">#!/usr/bin/sed -f
s/"//g  
s/\&lt;\(null\)\&gt;/'\1'/g  </code></pre>
<ul>
  <li>The monitoring stack can send alerts by email through an SMTP server. The following example sends the <code>PersistentVolumeUsageNearFull</code> alerts to the <code>ocp-admins@example.com</code> email address.</li>
</ul>
<pre><code class="language-plaintext">global:
  resolve_timeout: 5m
  smtp_from: alerts@ocp4.example.com  1
  smtp_smarthost: '192.168.50.254:25'  2
  smtp_hello: localhost  3
  smtp_auth_username: smtp_training  4
  smtp_auth_password: Red_H4T@!  5
  smtp_require_tls: false  6
...output omitted...
inhibit_rules:
  ...output omitted...
receivers:
  ...output omitted...
  - name: email  7
    email_configs:  8
      - to: ocp-admins@example.com  9
route:
  group_by:
    - namespace
  group_interval: 2m  10
  group_wait: 30s
  receiver: Default
  repeat_interval: 1m  11
  routes:
    ...output omitted...
    - receiver: email  12
      match:
        alertname: PersistentVolumeUsageNearFull  13
      continue: true  14
...output omitted...</code></pre>
<p>&nbsp;</p>
<figure class="table">
  <table style="background-color:rgb(255, 255, 255);">
    <tbody>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/1.svg" alt="1"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The global SMTP host. If you do not define <code>smarthost</code> in the <code>email_configs</code> field for a receiver, then this field is the default host in use.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/2.svg" alt="2"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The global email sender address. If you do not define <code>from</code> in the <code>email_configs</code> field for a receiver, then this field is the default address in use.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/3.svg" alt="3"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The hello parameter for the SMTP connection.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/4.svg" alt="4"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The global SMTP username for optional authentication. If you do not define <code>auth_username</code> in the <code>email_configs</code> field for a receiver, then this field is the default username in use.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/5.svg" alt="5"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The global SMTP password for optional authentication. This password is used if <code>auth_password</code> is not defined in the <code>email_configs</code> field for a receiver. If you do not define <code>auth_password</code> in the <code>email_configs</code> field for a receiver, then this field is the default password in use.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/6.svg" alt="6"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">A global setting to specify whether TLS is required for SMTP. You can override this setting by using <code>require_tls</code> in the <code>email_configs</code> field for a receiver.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/7.svg" alt="7"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">An arbitrary name for the receiver. A route specifies this receiver name for a match.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/8.svg" alt="8"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">This setting indicates that the receiver sends alerts by email.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/9.svg" alt="9"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The <code>to</code> setting must be specified in the <code>email_configs</code> field, and does not have an equivalent global SMTP setting.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/10.svg" alt="10"></figure>
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/11.svg" alt="11"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">Configure the <code>group_interval</code> and <code>repeat_interval</code> fields so the alert email notifications are sent more frequently.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/12.svg" alt="12"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The receiver to use if the <code>match</code> evaluates as <code>true</code> for the alert.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/13.svg" alt="13"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">The expression to match a specific alert name.</td>
      </tr>
      <tr>
        <td style="padding:0px;vertical-align:top;">
          <figure class="image image_resized" style="width:22px;"><img src="https://rol.redhat.com/rol/static/roc/Common_Content/images/14.svg" alt="14"></figure>
        </td>
        <td style="padding:0px;vertical-align:top;">By default, every alert that enters the routing tree stops after the first matching child. The <code>continue: true</code> parameter permitts the alert to continue through the routing tree matching subsequent routes.</td>
      </tr>
    </tbody>
  </table>
</figure>
<pre><code class="language-plaintext"> oc set data secret/alertmanager-main -n openshift-monitoring \
  --from-file alertmanager.yaml</code></pre>
<p>&nbsp;</p>
<pre><code class="language-plaintext">oc logs -f statefulset.apps/alertmanager-main -c alertmanager \
  -n openshift-monitoring</code></pre>
<h3>Alertmanager configuration</h3>
<h4>Configuring external alertmanager</h4>
<ol>
  <li>Edit the cluster-monitoring-config configmap in the openshift-monitoring namespace.</li>
</ol>
<pre><code class="language-plaintext">oc -n openshift-monitoring edit configmap cluster-monitoring-config</code></pre>
<p>&nbsp; 2. Add <code>additionalAlertmanagerConfigs</code> section with configuration details under <code>data/config.yaml/prometheusK8s</code>:</p>
<p>&nbsp;</p>
<pre><code class="language-plaintext">apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-monitoring-config
  namespace: openshift-monitoring
data:
  config.yaml: |
    prometheusK8s:
      additionalAlertmanagerConfigs:
      - scheme: https
        pathPrefix: /
        timeout: "30s"
        apiVersion: v1
        bearerToken:
          name: alertmanager-bearer-token
          key: &lt;token&gt;
        tlsConfig:
          key:
            name: alertmanager-tls
            key: &lt;key&gt;
          cert:
            name: alertmanager-tls
            key: &lt;crt&gt;
          ca:
            name: alertmanager-tls
            key: &lt;ca.crt&gt;
        staticConfigs:
        - &lt;FQDN of the external alertmanager&gt;
</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
