<!--
title: Chapter_Three ~ Fire
description: 
published: true
date: 2025-10-18T10:39:22.017Z
tags: 
editor: ckeditor
dateCreated: 2025-10-17T18:52:01.980Z
-->

<blockquote>
  <p><i>Governance</i> refers specifically to the set of rules, controls, policies, and resolutions in place to enforce policy standards. RHACM governance provides a policy-based approach for companies to monitor these standards.</p>
</blockquote>
<h3>Use cases of RHACM in governance&nbsp;</h3>
<ul>
  <li><strong>Manage compliance of multiple clusters, and remediates the non conformities by using policy controllers.</strong></li>
  <li><strong>Check for policy violations by</strong>
    <ul>
      <li>Enforce security by using <strong>built-in policies.</strong></li>
      <li>Install <strong>operators </strong>to check for policy violations.</li>
      <li>Detect certificates that are close to expiring or that contain DNS names that fail to match specified patterns across your clusters.</li>
    </ul>
  </li>
  <li><strong>Work across different environments, clouds, datacenters…</strong></li>
</ul>
<h3>Components of RHACM Governance</h3>
<ol>
  <li><strong>RHACM governance dashboard: </strong>displays a list of policies, cluster violations, and policy violations.</li>
  <li><strong>Policy-based governance framework: </strong>supports <mark class="marker-yellow">policy creation and deployment to the managed clusters based on placement rules</mark>.</li>
  <li><strong>Policy controllers:&nbsp;</strong>
    <ul>
      <li>Monitor policies and generate Kubernetes events for violation when the cluster is non-compliant.</li>
      <li>propagate the violations to the hub cluster.</li>
    </ul>
  </li>
  <li><strong>Open source community: </strong>The <code>stolostron/policy-collection</code> repository on GitHub has stable, community policy examples. You can contribute and deploy policies by using GitOps.</li>
</ol>
<h4>Policy-based Governance Framework Architecture</h4>
<ol>
  <li><strong>The policy propagator controller:</strong>
    <ul>
      <li>Generates the policies in the managed cluster namespace, depending on the placements that are bound to the root policy</li>
      <li>Watches Placement, PlacementBinding, PolicyAutomation objects</li>
      <li>Add the compliance state from replicated polices(the ones that it generated in the managed cluster namespaces) to the root policy</li>
      <li>Started the automated processes from policyAutomation objects&nbsp;</li>
    </ul>
  </li>
  <li><strong>The governance policy add-on controller:</strong>
    <ul>
      <li>Manages the installation of policy controllers on managed clusters, and manages the governance policy framework controller on the managed clusters</li>
    </ul>
  </li>
  <li><strong>The governance policy framework controller:</strong>
    <ul>
      <li>Runs as <code>governance-policy-framework</code> pod on managed clusters on the managed clusters. Contains many controllers:<ul>
          <li><code>Spec Sync</code> controller</li>
          <li><code>Status Sync</code> controller</li>
          <li><code>Template Sync</code> controller: monitors policies in the cluster namespace and updates defined objects in the policy templates for any policy change.</li>
          <li><code>Gatekeeper Sync</code> controller: &nbsp;records <code>Gatekeeper</code> constraint audit results as compliance events in the corresponding policies.</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>
<figure class="image image_resized" style="width:100%;"><img src="/governance-architecture-1.svg"></figure>
<h3>RHACM Policy Overview</h3>
<blockquote>
  <p>policy-based framework: Every <code>Policy</code> object requires the <code>policy-templates</code>, <code>Placement</code>, and <code>PlacementBinding</code> templates.</p>
</blockquote>
<ul>
  <li>Policy-template: provide a template inside the Policy object to create policies&nbsp;</li>
  <li>Placement: to target specific clusters</li>
  <li>PlacementBinding: to binds the policy to a placement object</li>
  <li>Policies cannot be created in the managed cluster namespaces, and RHACM will delete it automatically if created</li>
</ul>
<h4>Policy YAML File</h4>
<pre><code class="language-plaintext">apiVersion: policy.open-cluster-management.io/v1 
kind: Policy 
metadata:
  name: &lt; policy-namespace &gt;
  annotations: 
    policy.open-cluster-management.io/standards: NIST SP 800-53 
    policy.open-cluster-management.io/categories: CM Configuration Management 
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration 
spec:
  remediationAction: inform 
  disabled: false 
  policy-templates: 
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: policy-namespace-example
        spec:
          remediationAction: inform _# the policy-template spec.remediationAction is overridden by the preceding parameter value for spec.remediationAction._
          severity: low
          namespaceSelector:
            exclude: ["kube-*"]
            include: ["default"]
          object-templates:
            - complianceType: musthave
              objectDefinition:
                kind: Namespace _# must have namespace 'prod'_
                apiVersion: v1
                metadata:
                  name: prod
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: binding-policy-namespace
placementRef:
  name: placement-policy-namespace
  kind: Placement
  apiGroup: cluster.open-cluster-management.io
subjects:
- name: policy-namespace
  kind: Policy
  apiGroup: policy.open-cluster-management.io
---
apiVersion: cluster.open-cluster-management.io/v1
kind: Placement
metadata:
  name: placement-policy-namespace
spec:
  predicates:
  - requiredClusterSelector:11
      labelSelector:
        matchExpressions:
        - {key: environment, operator: In, values: ["dev"]}
    tolerations:
	- key: cluster.open-cluster-management.io/unavailable
          operator: Exists
        - key: cluster.open-cluster-management.io/unreachable
          operator: Exists</code></pre>
<h3>RHACM Policy Controllers Overview</h3>
<ul>
  <li>Policy controllers monitor whether your cluster complies with a policy, and report the policy status</li>
  <li>Supported controllers<ul>
      <li>Kubernetes Configuration Policy Controller<ul>
          <li>manages, configures, and monitors Kubernetes resources.</li>
          <li>monitors policy violations and remediates them by using the <i>enforce</i> feature.&nbsp;</li>
          <li>install, configure, or retrieve reports from other operators such as a compliance operator.</li>
        </ul>
      </li>
      <li>Certificate Policy Controller<ul>
          <li>monitors certificates for the selected namespaces.&nbsp;</li>
          <li>certificate policy has a namespace selector to exclude or include namespaces</li>
          <li>detects when a certificate is about to expire in the default namespace.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">policy-templates:
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: CertificatePolicy
      metadata:
        name: policy-certificate-example
      spec:
        namespaceSelector:
          include:
            - default
          exclude:
            - kube-*
        remediationAction: inform
        severity: low
        minimumDuration: 300h</code></pre>
<figure class="table">
  <table style="background-color:rgb(255, 255, 255);">
    <thead>
      <tr>
        <th style="padding:5px;vertical-align:top;">Parameter</th>
        <th style="padding:5px;vertical-align:top;">Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>severity</code></td>
        <td style="padding:5px;vertical-align:top;">Reports when the policy is non-compliant.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>remediationAction</code></td>
        <td style="padding:5px;vertical-align:top;">You can set the parameter to <code>inform</code>.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>minimumDuration</code></td>
        <td style="padding:5px;vertical-align:top;">The minimum duration for the certificate expiration. For example, if the parameter value is set to <code>300h</code>, and any certificates have an expiration age of fewer than 300 hours, then the policy displays the <code>Not-compliant</code> status.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>minimumCADuration</code></td>
        <td style="padding:5px;vertical-align:top;">The minimum duration for the signing certificate expiration.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>maximumDuration</code></td>
        <td style="padding:5px;vertical-align:top;">The maximum duration for the certificate expiration. For example, if the parameter value is set to <code>300h</code>, and any certificates have an expiration age of more than 300 hours, then the policy displays the <code>Not-compliant</code> status.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>maximumCADuration</code></td>
        <td style="padding:5px;vertical-align:top;">The maximum duration for the signing certificate expiration.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>allowedSANPattern</code></td>
        <td style="padding:5px;vertical-align:top;">You can specify an expression with this parameter. It compares patterns against DNS names. That expression must be present in every SAN entry in the certificates.</td>
      </tr>
      <tr>
        <td style="padding:5px;vertical-align:top;"><code>disallowedSANPattern</code></td>
        <td style="padding:5px;vertical-align:top;">You can specify an expression with this parameter. It compares patterns against DNS names. That expression must not be present in any SAN entry in the certificates.</td>
      </tr>
    </tbody>
  </table>
</figure>
<ul>
  <li>Policy Set Controller<ul>
      <li>place together the policies that are in the same namespace, to deploy them at the same time to a cluster.</li>
      <li>A <code>PolicySet</code> resource requires <code>PlacementBinding</code> to bind the <code>PolicySet</code> and <code>Placement</code> resources.</li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">apiVersion: policy.open-cluster-management.io/v1beta1
kind: PolicySet
metadata:
  name: pci
  namespace: default
spec:
  description: Policies for PCI compliance
  policies: 
  - policy-pod
  - policy-namespace
status:
  compliant: NonCompliant
  placement:
  - placementBinding: binding1
    placement: placement1
    policySet: policyset-ps</code></pre>
<ul>
  <li>Operator Policy Controller<ul>
      <li>install and monitor the Operator Lifecycle Manager (OLM) operators in your clusters</li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">apiVersion: policy.open-cluster-management.io/v1
kind: Policy 
metadata:
  name: install-quay
  namespace: open-cluster-management-global-set
spec:
  disabled: false
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1beta1
        kind: OperatorPolicy 
        metadata:
          name: install-quay
        spec:
          remediationAction: enforce 
          severity: critical
          complianceType: musthave 
          upgradeApproval: None 
          subscription: 
            channel: stable-3.11
            name: quay-operator
            source: redhat-operators
            sourceNamespace: openshift-marketplace </code></pre>
<p>&nbsp;</p>
<h3>Cleaning up</h3>
<pre><code class="language-plaintext">oc delete policy my-policy -n my-namespace

oc delete placementbinding my-placement-binding -n my-namespace

oc delete placementrule my-placement-rule -n my-namespace
</code></pre>
<p>&nbsp;</p>
<p>The <code>pruneObjectBehavior</code> parameter has the following possible values:</p>
<ul>
  <li><code>DeleteIfCreated</code>: This value cleans up any resources that the policy originally created, which is useful for policies that provision new resources.</li>
  <li><code>DeleteAll</code>: This option cleans up all resources that the policy managed, regardless of whether the policy originally created them.</li>
  <li><code>None</code>: With this default value, no related resources are deleted when the policy is removed. You must manually clean up any associated resources.</li>
</ul>
<h2>Policy Generator</h2>
<ul>
  <li>Convert any manifest files to RHACM configuration policies, including files that are created from the <code>kustomize</code> directory.</li>
  <li>Patch the input manifests before they are inserted into a generated RHACM policy.</li>
  <li>Generate additional configuration policies so you can report on Gatekeeper policy violations through RHACM.</li>
  <li>Generate policy sets on the hub cluster.</li>
</ul>
<h4>Interaction with Policy Generator</h4>
<ol>
  <li>By kustomize: by installing policy generator plugin into <code>${HOME}/.config/kustomize/plugin/policy.open-cluster-management.io/v1/policygenerator</code> directory.<ul>
      <li>requirements:<ul>
          <li>kustomization file: With policy-generator config file</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>
<pre><code class="language-plaintext">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
generators: 
- policy-generator-config.yaml</code></pre>
<pre><code class="language-plaintext">tree base
base/
├── kustomization.yaml
└── manifest-files
│   └── manifest.yaml &gt; objects to be included in the policy
└── policy-generator-config.yaml &gt; generator config file</code></pre>
<pre><code class="language-plaintext">apiVersion: policy.open-cluster-management.io/v1 &gt; policy generator config file
kind: PolicyGenerator
metadata:
  name: namespace-existence-policies
policyDefaults:
  namespace: policies 
  severity: low 
  remediationAction: inform 
  complianceType: musthave 
policies: 
  - name: &lt;object_name&gt;
    manifests: 
      - path: /manifest-files/manifest.yaml</code></pre>
<ul>
  <li>kubectl kustomize --enable-alpha-plugins <code><i>path-to-kustomize-directory</i></code></li>
</ul>
<ol>
  <li><strong>The PolicyGenerator command-line tool:</strong>
    <ul>
      <li><strong>Download from </strong>the <strong>Command Line Tools</strong> page in the RHACM web console</li>
    </ul>
  </li>
</ol>
<h4>The Policy Generator YAML Structure</h4>
<ul>
  <li><code>policyDefaults</code> section: introduce the default parameters&nbsp;<ul>
      <li>Except for the namespace, <mark class="marker-yellow">any default value that is configured in the </mark><code><mark class="marker-yellow">policyDefaults</mark></code><mark class="marker-yellow"> section is overridden by an entry in the </mark><code><mark class="marker-yellow">policies</mark></code><mark class="marker-yellow"> section</mark>, and any default value that is configured in the <code>policySetDefaults</code> section is overridden by an entry in the <code>policySets</code> section.</li>
    </ul>
  </li>
  <li><code>policies</code> section: Include a list of polices names and the paths of objects that is included in the policy</li>
</ul>
<pre><code class="language-plaintext">tree &lt;dir&gt;
policy-gen/
└── manifest-files
│   └── manifest.yaml
└── policy-generator-config.yaml</code></pre>
<pre><code class="language-plaintext">PolicyGenerator &lt;dir&gt;/policygenerator.yaml</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
