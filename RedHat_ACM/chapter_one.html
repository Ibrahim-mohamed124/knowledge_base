<!--
title: Chapter_one ~ Air
description: 
published: true
date: 2025-10-20T09:16:57.909Z
tags: openshift, acm, hub
editor: ckeditor
dateCreated: 2025-10-19T08:03:10.889Z
-->

<p>Notes:</p>
<ul>
  <li>The RHACM multicluster global hub enables centralized control of large-scale Kubernetes environments. Centralized control, policy enforcement, and integration with observability tools address the complexities of multicluster architectures.</li>
  <li>First at all it is only useful for large global enterprises with hybrid infrastructure because ACM has the ability to manage clusters in different platforms, but most implementations in Egypt are for small companies.</li>
  <li>It might be useful for these reasons:<ul>
      <li>RHACM platform compatibility, such as with x86 or Arm, ensures that<strong> legacy workloads</strong> run efficiently in private clouds. By managing OpenShift virtualization across different OpenShift clusters</li>
      <li>RHACM optimizes resource allocation across hybrid clouds to control expenses.</li>
      <li>RHACM enforces policies to meet <strong>compliance </strong>across private and public clouds.</li>
      <li><strong>cohesive IT infrastructure</strong>: blend public, private, and on-premise resources</li>
      <li>RHACM: Provides <strong>cluster lifecycle management</strong> from creation to destruction</li>
      <li>Observability stack of RHACM</li>
    </ul>
  </li>
</ul>
<p>∅ <strong>Scalability</strong>: Large cluster fleets overwhelm a single management hub, which requires division into smaller groups, <strong>with a hub to manage each group.</strong></p>
<h2>Core Components of the global ACM</h2>
<p>∅ <strong>Manages other ACMs</strong></p>
<ol>
  <li>Global hub operator: &nbsp;Control the lifecycle of global hub components such as global hub manager, Garfana, Kafka, Postgresql and &nbsp;global hub agent on the managed hub clusters</li>
  <li>Global hub manager: Inputs data from Kafka into Postgresql, and it posts data into Kafka for managing hub clusters</li>
  <li>Global hub agent: Runs on the managed hub cluster to gather data for the Global hub manager</li>
  <li>Global hub visualization: exposed by a route and provides info about clusters health, violations, compliance, and performance</li>
</ol>
<h2>&nbsp;Design considerations of the global ACM</h2>
<ul>
  <li>Storage: PostgreSQL requires at least 20&nbsp;GB to store data for three managed hubs with 250 clusters and 50 policies for 18 months.</li>
  <li>Networking: use secure HTTPS communication on port 443 for Grafana, Kafka, and PostgreSQL to ensure reliable connectivity.</li>
  <li>Middleware Integration: Organizations integrate existing Kafka version 3.4+, PostgreSQL version 13+, or Grafana instances instead of provided ones, to configure secrets and access appropriately.</li>
  <li>Access Control: The <code><strong>cluster-admin</strong></code> role remains necessary for installation, and <strong>Grafana access aligns with OpenShift console authentication</strong>. (depends on the same authentication of managed clusters?)</li>
</ul>
<h2>Architecture &nbsp;of ACM</h2>
<ol>
  <li>Hub Cluster = RHACM Cluster:<ul>
      <li>A central controller &gt; Users<strong> authenticate to the Hub cluster</strong> to access its console and APIs, which <strong>relies on the local cluster authentication layer.</strong></li>
      <li><code>MultiClusterHub</code> resource: is consumed by RHACM operator to manage the lifecycle of ACM components. It is created at <code>open-cluster-management</code> namespace.</li>
      <li>Gathers info from managed clusters in async method and &nbsp;maintains the state of clusters and applications that run on it.</li>
      <li>The <i>local cluster</i> refers to the OpenShift cluster that hosts the hub cluster. <strong>The local cluster is also a managed cluster.</strong></li>
    </ul>
  </li>
  <li>Managed Clusters:<ul>
      <li><code>klusterlet</code> component is the agent that is <strong>installed on the managed cluster</strong>, and controls the connections between the hub cluster and the managed cluster.</li>
    </ul>
  </li>
</ol>
<figure class="image"><img src="/arch.png"></figure>
<h2>&nbsp;Operations of ACM</h2>
<ul>
  <li>Lifecycle management:<ul>
      <li>creation, importing, managing, upgrading(individually or in bluk), destroying openshfit clusters across platforms</li>
      <li>this functionality is provided by <strong>multicluster engine for kubernetes operator </strong>that is installed by default with RHACM by using MultiClusterEngine resource that is consumed by <strong>multicluster engine operator</strong></li>
    </ul>
  </li>
  <li>Application Lifecycle:<ul>
      <li>manage the application resources across managed clusters</li>
      <li>Red&nbsp;Hat OpenShift GitOps, which is based on <strong>Argo CD</strong>, is integrated with RHACM.</li>
      <li><strong>Ansible Automation Platform jobs enable you to automate tasks.&nbsp;</strong></li>
    </ul>
  </li>
  <li>Governance:<ul>
      <li>define policies that either <strong>enforce </strong>security compliance or inform you of changes that <strong>violate </strong>the configured compliance requirements for your environment</li>
    </ul>
  </li>
  <li>Observability:<ul>
      <li>observability component collects and reports the status and health of OpenShift&nbsp;4.x or later versions of managed clusters to the hub cluster, which are visible from the Grafana dashboard.</li>
      <li>must be enabled after the RHACM installation, because it requires persistent storage.</li>
      <li>depend on open source tools like promtheus, thanos, alertmanager</li>
    </ul>
  </li>
</ul>
<h2>Instillation</h2>
<h4>Prerequisites and Sizing for RHACM</h4>
<ul>
  <li>Network communication between the hub cluster and the managed clusters</li>
  <li>Accurately sizing the hub cluster requires testing and monitoring the resource usage of the hub cluster and knowledge of what is deployed on it.</li>
</ul>
<p>&nbsp;</p>
<ol>
  <li>install the RHACM operator from the <strong>OperatorHub</strong> menu in the OpenShift web console</li>
  <li>recommended namespace for the installation is <code>open-cluster-management</code>.</li>
  <li>create the <code>MultiClusterHub</code> custom resource to deploy the RHACM services.</li>
</ol>
<pre><code class="language-plaintext">apiVersion: operator.open-cluster-management.io/v1
kind: MultiClusterHub
metadata:
  name: multiclusterhub
  namespace: open-cluster-management
spec: {}</code></pre>
<p>&nbsp;4. The custom resource creation displays the <code>Phase: Installing</code> status during installation, and takes several minutes to complete. After this custom resource creation process completes, the status changes to <code>Phase: Running</code>.</p>
<p>∅ <strong>the RHACM operator and the </strong><code><strong>MultiClusterHub</strong></code><strong> custom resource, to run on infrastructure nodes by using node selectors and tolerations.&nbsp;</strong></p>
<h3>Troubleshooting Installation Issues</h3>
<ul>
  <li>installation of the RHACM operator gets stuck in the <code>Pending</code> status<ul>
      <li>check the pods in the installation namespace</li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">reason: Unschedulable
message: '0/6 nodes are available: 3 Insufficient cpu, 3 node(s) had taint {node-role.kubernetes.io/master:
        }, that the pod didn't tolerate.'</code></pre>
<p>&nbsp;</p>
<ul>
  <li>OpenShift cluster is not connected to the internet</li>
  <li>images for the RHACM operator are not available in the local endpoint, for a disconnected installation.</li>
  <li>cluster nodes do not have enough resources to install the RHACM operator.</li>
</ul>
<p>&nbsp;</p>
<ul>
  <li>the RHACM operator might encounter installation issues after a prior failure of installation or uninstallation of the operator:<ul>
      <li>This issue can occur when the operator is uninstalled, but the custom resources are not removed</li>
    </ul>
  </li>
</ul>
<pre><code class="language-plaintext">MCE_NAMESPACE=open-cluster-management
oc delete multiclusterengine --all
oc delete apiservice v1.admission.cluster.open-cluster-management.io v1.admission.work.open-cluster-management.io
oc delete crd discoveredclusters.discovery.open-cluster-management.io discoveryconfigs.discovery.open-cluster-management.io
oc delete mutatingwebhookconfiguration ocm-mutating-webhook managedclustermutators.admission.cluster.open-cluster-management.io
oc delete validatingwebhookconfiguration ocm-validating-webhook
oc delete ns $MCE_NAMESPACE</code></pre>
